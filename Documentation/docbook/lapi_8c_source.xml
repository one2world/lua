<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_lapi_8c_source" xml:lang="zh">
<title>D:/gitworkspace/lua/lapi.c</title>
<programlisting>00001 <emphasis role="comment">/*</emphasis>
00002 <emphasis role="comment">**&#32;$Id:&#32;lapi.c&#32;$</emphasis>
00003 <emphasis role="comment">**&#32;Lua&#32;API</emphasis>
00004 <emphasis role="comment">**&#32;See&#32;Copyright&#32;Notice&#32;in&#32;lua.h</emphasis>
00005 <emphasis role="comment">*/</emphasis>
00006 
<anchor xml:id="_lapi_8c_source_1l00007"/><link linkend="_lapi_8c_1a6f4862161259fd87002d41735b0ccfa8">00007</link> <emphasis role="preprocessor">#define&#32;lapi_c</emphasis>
<anchor xml:id="_lapi_8c_source_1l00008"/><link linkend="_lapi_8c_1abf0b3947b59218777a8e928a10be205b">00008</link> <emphasis role="preprocessor">#define&#32;LUA_CORE</emphasis>
00009 
00010 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lprefix_8h">lprefix.h</link>&quot;</emphasis>
00011 
00012 
00013 <emphasis role="preprocessor">#include&#32;&lt;limits.h&gt;</emphasis>
00014 <emphasis role="preprocessor">#include&#32;&lt;stdarg.h&gt;</emphasis>
00015 <emphasis role="preprocessor">#include&#32;&lt;string.h&gt;</emphasis>
00016 
00017 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lua_8h">lua.h</link>&quot;</emphasis>
00018 
00019 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lapi_8h">lapi.h</link>&quot;</emphasis>
00020 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_ldebug_8h">ldebug.h</link>&quot;</emphasis>
00021 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_ldo_8h">ldo.h</link>&quot;</emphasis>
00022 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lfunc_8h">lfunc.h</link>&quot;</emphasis>
00023 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lgc_8h">lgc.h</link>&quot;</emphasis>
00024 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lmem_8h">lmem.h</link>&quot;</emphasis>
00025 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lobject_8h">lobject.h</link>&quot;</emphasis>
00026 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lstate_8h">lstate.h</link>&quot;</emphasis>
00027 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lstring_8h">lstring.h</link>&quot;</emphasis>
00028 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_ltable_8h">ltable.h</link>&quot;</emphasis>
00029 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_ltm_8h">ltm.h</link>&quot;</emphasis>
00030 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lundump_8h">lundump.h</link>&quot;</emphasis>
00031 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_lvm_8h">lvm.h</link>&quot;</emphasis>
00032 
00033 
00034 
<anchor xml:id="_lapi_8c_source_1l00035"/><link linkend="_lua_8h_1acbf4dc2e5f80547c7f54f41a179258b2">00035</link> <emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;<link linkend="_lapi_8c_1acbf4dc2e5f80547c7f54f41a179258b2">lua_ident</link>[]&#32;=
00036 &#32;&#32;<emphasis role="stringliteral">&quot;$LuaVersion:&#32;&quot;</emphasis>&#32;<link linkend="_lua_8h_1a5126fa04dbeee0b9118c769beadcd62d">LUA_COPYRIGHT</link>&#32;<emphasis role="stringliteral">&quot;&#32;$&quot;</emphasis>
00037 &#32;&#32;<emphasis role="stringliteral">&quot;$LuaAuthors:&#32;&quot;</emphasis>&#32;<link linkend="_lua_8h_1ab6ff0964a416a9a7c1e90337c965f102">LUA_AUTHORS</link>&#32;<emphasis role="stringliteral">&quot;&#32;$&quot;</emphasis>;
00038 
00039 
00040 
00041 <emphasis role="comment">/*</emphasis>
00042 <emphasis role="comment">**&#32;Test&#32;for&#32;a&#32;valid&#32;index.</emphasis>
00043 <emphasis role="comment">**&#32;&apos;!ttisnil(o)&apos;&#32;implies&#32;&apos;o&#32;!=&#32;&amp;G(L)-&gt;nilvalue&apos;,&#32;so&#32;it&#32;is&#32;not&#32;needed.</emphasis>
00044 <emphasis role="comment">**&#32;However,&#32;it&#32;covers&#32;the&#32;most&#32;common&#32;cases&#32;in&#32;a&#32;faster&#32;way.</emphasis>
00045 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00046"/><link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">00046</link> <emphasis role="preprocessor">#define&#32;isvalid(L,&#32;o)&#32;&#32;&#32;(!ttisnil(o)&#32;||&#32;o&#32;!=&#32;&amp;G(L)-&gt;nilvalue)</emphasis>
00047 
00048 
00049 <emphasis role="comment">/*&#32;test&#32;for&#32;pseudo&#32;index&#32;*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00050"/><link linkend="_lapi_8c_1a23aaf36182310f7e0108a065732710a2">00050</link> <emphasis role="preprocessor">#define&#32;ispseudo(i)&#32;&#32;&#32;&#32;&#32;((i)&#32;&lt;=&#32;LUA_REGISTRYINDEX)</emphasis>
00051 
00052 <emphasis role="comment">/*&#32;test&#32;for&#32;upvalue&#32;*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00053"/><link linkend="_lapi_8c_1aa8693ff1ffbbabc73472cd938dbd8086">00053</link> <emphasis role="preprocessor">#define&#32;isupvalue(i)&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;((i)&#32;&lt;&#32;LUA_REGISTRYINDEX)</emphasis>
00054 
00055 
<anchor xml:id="_lapi_8c_source_1l00056"/><link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">00056</link> <emphasis role="keyword">static</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00057 &#32;&#32;<link linkend="_struct_call_info">CallInfo</link>&#32;*ci&#32;=&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>;
00058 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(idx&#32;&gt;&#32;0)&#32;{
00059 &#32;&#32;&#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;o&#32;=&#32;ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;+&#32;idx;
00060 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;idx&#32;&lt;=&#32;L-&gt;ci-&gt;<link linkend="_struct_call_info_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;(ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;+&#32;1),&#32;<emphasis role="stringliteral">&quot;unacceptable&#32;index&quot;</emphasis>);
00061 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(o&#32;&gt;=&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;nilvalue;
00062 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(o);
00063 &#32;&#32;}
00064 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_lapi_8c_1a23aaf36182310f7e0108a065732710a2">ispseudo</link>(idx))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;negative&#32;index&#32;*/</emphasis>
00065 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;idx&#32;!=&#32;0&#32;&amp;&amp;&#32;-idx&#32;&lt;=&#32;L-&gt;top&#32;-&#32;(ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;+&#32;1),&#32;<emphasis role="stringliteral">&quot;invalid&#32;index&quot;</emphasis>);
00066 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;idx);
00067 &#32;&#32;}
00068 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(idx&#32;==&#32;<link linkend="_lua_8h_1a3524c2bbc8fcf847dc083246b62945dd">LUA_REGISTRYINDEX</link>)
00069 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;l_registry;
00070 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;upvalues&#32;*/</emphasis>
00071 &#32;&#32;&#32;&#32;idx&#32;=&#32;<link linkend="_lua_8h_1a3524c2bbc8fcf847dc083246b62945dd">LUA_REGISTRYINDEX</link>&#32;-&#32;idx;
00072 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;idx&#32;&lt;=&#32;<link linkend="_lfunc_8h_1ac5b64a112a390053ec98913b67b3f112">MAXUPVAL</link>&#32;+&#32;1,&#32;<emphasis role="stringliteral">&quot;upvalue&#32;index&#32;too&#32;large&quot;</emphasis>);
00073 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a8d43f35dfc5fcd0ee49a6206d63bec18">ttislcf</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>)))&#32;&#32;<emphasis role="comment">/*&#32;light&#32;C&#32;function?&#32;*/</emphasis>
00074 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;nilvalue;&#32;&#32;<emphasis role="comment">/*&#32;it&#32;has&#32;no&#32;upvalues&#32;*/</emphasis>
00075 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00076 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_c_closure">CClosure</link>&#32;*func&#32;=&#32;<link linkend="_lobject_8h_1a2c2d10bdd241446b4c9e1b68268159bc">clCvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>));
00077 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(idx&#32;&lt;=&#32;func-&gt;nupvalues)&#32;?&#32;&amp;func-&gt;<link linkend="_struct_c_closure_1a5d6ca5386d338c19af338be60a375dd4">upvalue</link>[idx-1]&#32;:&#32;&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;nilvalue;
00078 &#32;&#32;&#32;&#32;}
00079 &#32;&#32;}
00080 }
00081 
00082 
<anchor xml:id="_lapi_8c_source_1l00083"/><link linkend="_lapi_8c_1a7acfd65878b2f2c7529c788ce08d1949">00083</link> <emphasis role="keyword">static</emphasis>&#32;<link linkend="_union_stack_value">StkId</link>&#32;<link linkend="_lapi_8c_1a7acfd65878b2f2c7529c788ce08d1949">index2stack</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00084 &#32;&#32;<link linkend="_struct_call_info">CallInfo</link>&#32;*ci&#32;=&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>;
00085 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(idx&#32;&gt;&#32;0)&#32;{
00086 &#32;&#32;&#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;o&#32;=&#32;ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;+&#32;idx;
00087 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;o&#32;&lt;&#32;L-&gt;top,&#32;<emphasis role="stringliteral">&quot;unacceptable&#32;index&quot;</emphasis>);
00088 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;o;
00089 &#32;&#32;}
00090 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;non-positive&#32;index&#32;*/</emphasis>
00091 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;idx&#32;!=&#32;0&#32;&amp;&amp;&#32;-idx&#32;&lt;=&#32;L-&gt;top&#32;-&#32;(ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;+&#32;1),&#32;<emphasis role="stringliteral">&quot;invalid&#32;index&quot;</emphasis>);
00092 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;!<link linkend="_lapi_8c_1a23aaf36182310f7e0108a065732710a2">ispseudo</link>(idx),&#32;<emphasis role="stringliteral">&quot;invalid&#32;index&quot;</emphasis>);
00093 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;idx;
00094 &#32;&#32;}
00095 }
00096 
00097 
<anchor xml:id="_lapi_8c_source_1l00098"/><link linkend="_lua_8h_1a3da4830349a139e15b4c08ced6739f0a">00098</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a1d762b92d5d82d6fa9f54ccf5c89d6a2">lua_checkstack</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00099 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;res;
00100 &#32;&#32;<link linkend="_struct_call_info">CallInfo</link>&#32;*ci;
00101 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00102 &#32;&#32;ci&#32;=&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>;
00103 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;n&#32;&gt;=&#32;0,&#32;<emphasis role="stringliteral">&quot;negative&#32;&apos;n&apos;&quot;</emphasis>);
00104 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(L-&gt;<link linkend="_structlua___state_1a21d8865731396f21a8b5bfd449c2354a">stack_last</link>&#32;-&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;&gt;&#32;n)&#32;&#32;<emphasis role="comment">/*&#32;stack&#32;large&#32;enough?&#32;*/</emphasis>
00105 &#32;&#32;&#32;&#32;res&#32;=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;yes;&#32;check&#32;is&#32;OK&#32;*/</emphasis>
00106 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;no;&#32;need&#32;to&#32;grow&#32;stack&#32;*/</emphasis>
00107 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;inuse&#32;=&#32;<link linkend="_llimits_8h_1a37a9e2c4b53433d34bad0f12a1500c08">cast_int</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;L-&gt;<link linkend="_structlua___state_1a8d64aaa9257b553aae2e3e193c80a83f">stack</link>)&#32;+&#32;<link linkend="_lstate_8h_1a9e690b8e4047af306d2dd1f78a9094d7">EXTRA_STACK</link>;
00108 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(inuse&#32;&gt;&#32;<link linkend="_ltests_8h_1ad7b065ae58f10bfa5800866b84de5f1e">LUAI_MAXSTACK</link>&#32;-&#32;n)&#32;&#32;<emphasis role="comment">/*&#32;can&#32;grow&#32;without&#32;overflow?&#32;*/</emphasis>
00109 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;no&#32;*/</emphasis>
00110 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;&#32;<emphasis role="comment">/*&#32;try&#32;to&#32;grow&#32;stack&#32;*/</emphasis>
00111 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ldo_8c_1a728937587ac9d9e316bd410991f11221">luaD_growstack</link>(L,&#32;n,&#32;0);
00112 &#32;&#32;}
00113 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;&amp;&amp;&#32;ci-&gt;<link linkend="_struct_call_info_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;&lt;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;n)
00114 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;=&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;n;&#32;&#32;<emphasis role="comment">/*&#32;adjust&#32;frame&#32;top&#32;*/</emphasis>
00115 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00116 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
00117 }
00118 
00119 
<anchor xml:id="_lapi_8c_source_1l00120"/><link linkend="_lua_8h_1a389cf4bf773f353508a28293143d403e">00120</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1ae27bb8d0218710bbbfefc1f573839d6d">lua_xmove</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*from,&#32;<link linkend="_structlua___state">lua_State</link>&#32;*to,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00121 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;i;
00122 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(from&#32;==&#32;to)&#32;<emphasis role="keywordflow">return</emphasis>;
00123 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(to);
00124 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(from,&#32;n);
00125 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(from,&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(from)&#32;==&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(to),&#32;<emphasis role="stringliteral">&quot;moving&#32;among&#32;independent&#32;states&quot;</emphasis>);
00126 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(from,&#32;to-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;to-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;&gt;=&#32;n,&#32;<emphasis role="stringliteral">&quot;stack&#32;overflow&quot;</emphasis>);
00127 &#32;&#32;from-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-=&#32;n;
00128 &#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;n;&#32;i++)&#32;{
00129 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1af9258d87e8f082be8a2adb731d90f1a5">setobjs2s</link>(to,&#32;to-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;from-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;i);
00130 &#32;&#32;&#32;&#32;to-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>++;&#32;&#32;<emphasis role="comment">/*&#32;stack&#32;already&#32;checked&#32;by&#32;previous&#32;&apos;api_check&apos;&#32;*/</emphasis>
00131 &#32;&#32;}
00132 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(to);
00133 }
00134 
00135 
<anchor xml:id="_lapi_8c_source_1l00136"/><link linkend="_lua_8h_1a21ccd6b330c56c62fc3d0f15dd59f7a7">00136</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1a878b7e392e78661a374cf1c3073029b9">lua_CFunction</link>&#32;<link linkend="_lapi_8c_1a90bf785da77985164dbe2eb0d64bf82e">lua_atpanic</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a878b7e392e78661a374cf1c3073029b9">lua_CFunction</link>&#32;panicf)&#32;{
00137 &#32;&#32;<link linkend="_lua_8h_1a878b7e392e78661a374cf1c3073029b9">lua_CFunction</link>&#32;old;
00138 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00139 &#32;&#32;old&#32;=&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;panic;
00140 &#32;&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;panic&#32;=&#32;panicf;
00141 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00142 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;old;
00143 }
00144 
00145 
<anchor xml:id="_lapi_8c_source_1l00146"/><link linkend="_lua_8h_1aa7bd1663f4030328b921dbdd6ee2070b">00146</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1af0a6ed3b852d680769cfc410a0672172">lua_Number</link>&#32;<link linkend="_lapi_8c_1a173602b148e6a610676e866fb7874ff1">lua_version</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L)&#32;{
00147 &#32;&#32;<link linkend="_llimits_8h_1a86d500a34c624c2cae56bc25a31b12f3">UNUSED</link>(L);
00148 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lua_8h_1a4c575ef5fb9bad1872613a9d832486a5">LUA_VERSION_NUM</link>;
00149 }
00150 
00151 
00152 
00153 <emphasis role="comment">/*</emphasis>
00154 <emphasis role="comment">**&#32;basic&#32;stack&#32;manipulation</emphasis>
00155 <emphasis role="comment">*/</emphasis>
00156 
00157 
00158 <emphasis role="comment">/*</emphasis>
00159 <emphasis role="comment">**&#32;convert&#32;an&#32;acceptable&#32;stack&#32;index&#32;into&#32;an&#32;absolute&#32;index</emphasis>
00160 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00161"/><link linkend="_lua_8h_1a0b801f6cd9f8420053c0bb053a38cc9a">00161</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a32821b04960f1c1223132349d04911c1">lua_absindex</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00162 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(idx&#32;&gt;&#32;0&#32;||&#32;<link linkend="_lapi_8c_1a23aaf36182310f7e0108a065732710a2">ispseudo</link>(idx))
00163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;?&#32;idx
00164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:&#32;<link linkend="_llimits_8h_1a37a9e2c4b53433d34bad0f12a1500c08">cast_int</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>)&#32;+&#32;idx;
00165 }
00166 
00167 
<anchor xml:id="_lapi_8c_source_1l00168"/><link linkend="_lua_8h_1ac5d7d4db9186b87ab018916e8826f008">00168</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1afbb08ecb69421875494105d4de68e5bf">lua_gettop</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L)&#32;{
00169 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_llimits_8h_1a37a9e2c4b53433d34bad0f12a1500c08">cast_int</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;(L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;+&#32;1));
00170 }
00171 
00172 
<anchor xml:id="_lapi_8c_source_1l00173"/><link linkend="_lua_8h_1a6cb9c62b9d85b1ad2a04d72bcb733816">00173</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1adaa30f0d34786144c94644039d1d1b6e">lua_settop</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00174 &#32;&#32;<link linkend="_struct_call_info">CallInfo</link>&#32;*ci;
00175 &#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;func;
00176 &#32;&#32;ptrdiff_t&#32;diff;&#32;&#32;<emphasis role="comment">/*&#32;difference&#32;for&#32;new&#32;top&#32;*/</emphasis>
00177 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00178 &#32;&#32;ci&#32;=&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>;
00179 &#32;&#32;func&#32;=&#32;ci-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>;
00180 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(idx&#32;&gt;=&#32;0)&#32;{
00181 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;idx&#32;&lt;=&#32;ci-&gt;top&#32;-&#32;(func&#32;+&#32;1),&#32;<emphasis role="stringliteral">&quot;new&#32;top&#32;too&#32;large&quot;</emphasis>);
00182 &#32;&#32;&#32;&#32;diff&#32;=&#32;((func&#32;+&#32;1)&#32;+&#32;idx)&#32;-&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>;
00183 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;&#32;diff&#32;&gt;&#32;0;&#32;diff--)
00184 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1ad9034def7bbc1965ec3d714d84620b07">setnilvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>++));&#32;&#32;<emphasis role="comment">/*&#32;clear&#32;new&#32;slots&#32;*/</emphasis>
00185 &#32;&#32;}
00186 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00187 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;-(idx+1)&#32;&lt;=&#32;(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;(func&#32;+&#32;1)),&#32;<emphasis role="stringliteral">&quot;invalid&#32;new&#32;top&quot;</emphasis>);
00188 &#32;&#32;&#32;&#32;diff&#32;=&#32;idx&#32;+&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;will&#32;&quot;subtract&quot;&#32;index&#32;(as&#32;it&#32;is&#32;negative)&#32;*/</emphasis>
00189 &#32;&#32;}
00190 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(diff&#32;&lt;&#32;0&#32;&amp;&amp;&#32;<link linkend="_lapi_8h_1a5707387c1d9df9ae5bea729c1109ddf6">hastocloseCfunc</link>(ci-&gt;<link linkend="_struct_call_info_1a2c5cabcdf2f8f5b8e0c72171401e0430">nresults</link>))
00191 &#32;&#32;&#32;&#32;<link linkend="_lfunc_8c_1ae9fcbf80b5969afd9412b9aed102f94e">luaF_close</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;diff,&#32;<link linkend="_lua_8h_1ab969ff78cb1b63efa2bba3bdfa6fff5c">LUA_OK</link>);
00192 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+=&#32;diff;&#32;&#32;<emphasis role="comment">/*&#32;correct&#32;top&#32;only&#32;after&#32;closing&#32;any&#32;upvalue&#32;*/</emphasis>
00193 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00194 }
00195 
00196 
00197 <emphasis role="comment">/*</emphasis>
00198 <emphasis role="comment">**&#32;Reverse&#32;the&#32;stack&#32;segment&#32;from&#32;&apos;from&apos;&#32;to&#32;&apos;to&apos;</emphasis>
00199 <emphasis role="comment">**&#32;(auxiliary&#32;to&#32;&apos;lua_rotate&apos;)</emphasis>
00200 <emphasis role="comment">**&#32;Note&#32;that&#32;we&#32;move(copy)&#32;only&#32;the&#32;value&#32;inside&#32;the&#32;stack.</emphasis>
00201 <emphasis role="comment">**&#32;(We&#32;do&#32;not&#32;move&#32;additional&#32;fields&#32;that&#32;may&#32;exist.)</emphasis>
00202 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00203"/><link linkend="_lapi_8c_1a2c07d0a193ad3ae19b4682ed92973c70">00203</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a2c07d0a193ad3ae19b4682ed92973c70">reverse</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_union_stack_value">StkId</link>&#32;from,&#32;<link linkend="_union_stack_value">StkId</link>&#32;to)&#32;{
00204 &#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;&#32;from&#32;&lt;&#32;to;&#32;from++,&#32;to--)&#32;{
00205 &#32;&#32;&#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;temp;
00206 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1acf2af15f3d5cceca8e8870f96634bc2d">setobj</link>(L,&#32;&amp;temp,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(from));
00207 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1af9258d87e8f082be8a2adb731d90f1a5">setobjs2s</link>(L,&#32;from,&#32;to);
00208 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;to,&#32;&amp;temp);
00209 &#32;&#32;}
00210 }
00211 
00212 
00213 <emphasis role="comment">/*</emphasis>
00214 <emphasis role="comment">**&#32;Let&#32;x&#32;=&#32;AB,&#32;where&#32;A&#32;is&#32;a&#32;prefix&#32;of&#32;length&#32;&apos;n&apos;.&#32;Then,</emphasis>
00215 <emphasis role="comment">**&#32;rotate&#32;x&#32;n&#32;==&#32;BA.&#32;But&#32;BA&#32;==&#32;(A^r&#32;.&#32;B^r)^r.</emphasis>
00216 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00217"/><link linkend="_lua_8h_1af42436f02336933ec56d0db874b4d97b">00217</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1af680e24129c0e021b4fbb7700cf185dc">lua_rotate</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00218 &#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;p,&#32;t,&#32;m;
00219 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00220 &#32;&#32;t&#32;=&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;end&#32;of&#32;stack&#32;segment&#32;being&#32;rotated&#32;*/</emphasis>
00221 &#32;&#32;p&#32;=&#32;<link linkend="_lapi_8c_1a7acfd65878b2f2c7529c788ce08d1949">index2stack</link>(L,&#32;idx);&#32;&#32;<emphasis role="comment">/*&#32;start&#32;of&#32;segment&#32;*/</emphasis>
00222 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;(n&#32;&gt;=&#32;0&#32;?&#32;n&#32;:&#32;-n)&#32;&lt;=&#32;(t&#32;-&#32;p&#32;+&#32;1),&#32;<emphasis role="stringliteral">&quot;invalid&#32;&apos;n&apos;&quot;</emphasis>);
00223 &#32;&#32;m&#32;=&#32;(n&#32;&gt;=&#32;0&#32;?&#32;t&#32;-&#32;n&#32;:&#32;p&#32;-&#32;n&#32;-&#32;1);&#32;&#32;<emphasis role="comment">/*&#32;end&#32;of&#32;prefix&#32;*/</emphasis>
00224 &#32;&#32;<link linkend="_lapi_8c_1a2c07d0a193ad3ae19b4682ed92973c70">reverse</link>(L,&#32;p,&#32;m);&#32;&#32;<emphasis role="comment">/*&#32;reverse&#32;the&#32;prefix&#32;with&#32;length&#32;&apos;n&apos;&#32;*/</emphasis>
00225 &#32;&#32;<link linkend="_lapi_8c_1a2c07d0a193ad3ae19b4682ed92973c70">reverse</link>(L,&#32;m&#32;+&#32;1,&#32;t);&#32;&#32;<emphasis role="comment">/*&#32;reverse&#32;the&#32;suffix&#32;*/</emphasis>
00226 &#32;&#32;<link linkend="_lapi_8c_1a2c07d0a193ad3ae19b4682ed92973c70">reverse</link>(L,&#32;p,&#32;t);&#32;&#32;<emphasis role="comment">/*&#32;reverse&#32;the&#32;entire&#32;segment&#32;*/</emphasis>
00227 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00228 }
00229 
00230 
<anchor xml:id="_lapi_8c_source_1l00231"/><link linkend="_lua_8h_1a7ca1468a179ad07411a0caf7d7dba9f4">00231</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a111bd3fa34fe656f415edae5e343e13e">lua_copy</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;fromidx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;toidx)&#32;{
00232 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*fr,&#32;*to;
00233 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00234 &#32;&#32;fr&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;fromidx);
00235 &#32;&#32;to&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;toidx);
00236 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">isvalid</link>(L,&#32;to),&#32;<emphasis role="stringliteral">&quot;invalid&#32;index&quot;</emphasis>);
00237 &#32;&#32;<link linkend="_lobject_8h_1acf2af15f3d5cceca8e8870f96634bc2d">setobj</link>(L,&#32;to,&#32;fr);
00238 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lapi_8c_1aa8693ff1ffbbabc73472cd938dbd8086">isupvalue</link>(toidx))&#32;&#32;<emphasis role="comment">/*&#32;function&#32;upvalue?&#32;*/</emphasis>
00239 &#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a21660a316c42bc1aad10f115e2261bca">luaC_barrier</link>(L,&#32;<link linkend="_lobject_8h_1a2c2d10bdd241446b4c9e1b68268159bc">clCvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1a9d82a8ad04b0dd8837e621047972260a">func</link>)),&#32;fr);
00240 &#32;&#32;<emphasis role="comment">/*&#32;LUA_REGISTRYINDEX&#32;does&#32;not&#32;need&#32;gc&#32;barrier</emphasis>
00241 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;(collector&#32;revisits&#32;it&#32;before&#32;finishing&#32;collection)&#32;*/</emphasis>
00242 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00243 }
00244 
00245 
<anchor xml:id="_lapi_8c_source_1l00246"/><link linkend="_lua_8h_1a95e1c0a61aff11059655e6d246bcace7">00246</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a602f61a9b583d69dc1c72c8970bd65e8">lua_pushvalue</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00247 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00248 &#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx));
00249 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00250 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00251 }
00252 
00253 
00254 
00255 <emphasis role="comment">/*</emphasis>
00256 <emphasis role="comment">**&#32;access&#32;functions&#32;(stack&#32;-&gt;&#32;C)</emphasis>
00257 <emphasis role="comment">*/</emphasis>
00258 
00259 
<anchor xml:id="_lapi_8c_source_1l00260"/><link linkend="_lua_8h_1aa988ba5b97ff838ccb92babd63063273">00260</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a652b273947f0656686f998d8e90cd3ea">lua_type</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00261 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00262 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">isvalid</link>(L,&#32;o)&#32;?&#32;<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(o)&#32;:&#32;<link linkend="_lua_8h_1a39c27eef097c704eee3536906dea5380">LUA_TNONE</link>);
00263 }
00264 
00265 
<anchor xml:id="_lapi_8c_source_1l00266"/><link linkend="_lua_8h_1a963a421b920cd7ce229f82091eab18a9">00266</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1a7d64f87addab440bbda96bb088816e17">lua_typename</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;t)&#32;{
00267 &#32;&#32;<link linkend="_llimits_8h_1a86d500a34c624c2cae56bc25a31b12f3">UNUSED</link>(L);
00268 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lua_8h_1a39c27eef097c704eee3536906dea5380">LUA_TNONE</link>&#32;&lt;=&#32;t&#32;&amp;&amp;&#32;t&#32;&lt;&#32;<link linkend="_lua_8h_1a99a031e2239fe191c2a4e1dfb7511d87">LUA_NUMTYPES</link>,&#32;<emphasis role="stringliteral">&quot;invalid&#32;type&quot;</emphasis>);
00269 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ltm_8h_1a7e8b7062137f42da8f8478d7e48004b3">ttypename</link>(t);
00270 }
00271 
00272 
<anchor xml:id="_lapi_8c_source_1l00273"/><link linkend="_lua_8h_1a6b2ce32286576a8e36fe4629662cb536">00273</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a3b922032c9fe2930399186a3647cc3ad">lua_iscfunction</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00274 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00275 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_lobject_8h_1a8d43f35dfc5fcd0ee49a6206d63bec18">ttislcf</link>(o)&#32;||&#32;(<link linkend="_lobject_8h_1a9510da9838a8f17b4eef364549a4c7a8">ttisCclosure</link>(o)));
00276 }
00277 
00278 
<anchor xml:id="_lapi_8c_source_1l00279"/><link linkend="_lua_8h_1af8f87f4e8a57a2168837c00c1ea4a41d">00279</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aba53e83eb1fff94b5ed96203bb52d8ae">lua_isinteger</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00280 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00281 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1abade243295a9140f7b86838fbb049054">ttisinteger</link>(o);
00282 }
00283 
00284 
<anchor xml:id="_lapi_8c_source_1l00285"/><link linkend="_lua_8h_1a2b5321e5370d82564c138e9dd8ffc9a5">00285</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a99451f234bf085c9c46c3d17a5aef905">lua_isnumber</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00286 &#32;&#32;<link linkend="_lua_8h_1af0a6ed3b852d680769cfc410a0672172">lua_Number</link>&#32;n;
00287 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00288 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lvm_8h_1af9edcc5da8ea1ac07ffdf79fbe5bb95c">tonumber</link>(o,&#32;&amp;n);
00289 }
00290 
00291 
<anchor xml:id="_lapi_8c_source_1l00292"/><link linkend="_lua_8h_1a70f6031d538713cb3b6093adbc658909">00292</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a9f20233199a414b04c1c4b43f5d040f3">lua_isstring</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00293 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00294 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_lobject_8h_1a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</link>(o)&#32;||&#32;<link linkend="_lvm_8h_1aa6af30bdcb0dce1826c81061cec16d81">cvt2str</link>(o));
00295 }
00296 
00297 
<anchor xml:id="_lapi_8c_source_1l00298"/><link linkend="_lua_8h_1af4cc013f4e4e84fc89bab292bd410981">00298</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aa8a1dab86cfb4e0f9a4d1f699af0041b">lua_isuserdata</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00299 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00300 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_lobject_8h_1a2b0d95af67f53d9fe2bdde605f9cd957">ttisfulluserdata</link>(o)&#32;||&#32;<link linkend="_lobject_8h_1a6440445277dce2e73af1e043f9884d7a">ttislightuserdata</link>(o));
00301 }
00302 
00303 
<anchor xml:id="_lapi_8c_source_1l00304"/><link linkend="_lua_8h_1a2cd7fef8e86adabbfec04ddb15aeebda">00304</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1ace66ea78ced7fda0b367f45d09d10d83">lua_rawequal</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;index1,&#32;<emphasis role="keywordtype">int</emphasis>&#32;index2)&#32;{
00305 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o1&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;index1);
00306 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o2&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;index2);
00307 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">isvalid</link>(L,&#32;o1)&#32;&amp;&amp;&#32;<link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">isvalid</link>(L,&#32;o2))&#32;?&#32;<link linkend="_lvm_8h_1aedbcec0d2a0e951710844d11dfa59a07">luaV_rawequalobj</link>(o1,&#32;o2)&#32;:&#32;0;
00308 }
00309 
00310 
<anchor xml:id="_lapi_8c_source_1l00311"/><link linkend="_lua_8h_1ab0a8e0d4a119fa51c2785e25d5b5aa08">00311</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a08501a34884feca01759dec174d69c88">lua_arith</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;op)&#32;{
00312 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00313 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(op&#32;!=&#32;<link linkend="_lua_8h_1ae976b4a61ff4d4b3bb8cd85cdcceda10">LUA_OPUNM</link>&#32;&amp;&amp;&#32;op&#32;!=&#32;<link linkend="_lua_8h_1a57e9cb582d0a570cd482936771be1ead">LUA_OPBNOT</link>)
00314 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;2);&#32;&#32;<emphasis role="comment">/*&#32;all&#32;other&#32;operations&#32;expect&#32;two&#32;operands&#32;*/</emphasis>
00315 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;for&#32;unary&#32;operations,&#32;add&#32;fake&#32;2nd&#32;operand&#32;*/</emphasis>
00316 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00317 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1af9258d87e8f082be8a2adb731d90f1a5">setobjs2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1);
00318 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00319 &#32;&#32;}
00320 &#32;&#32;<emphasis role="comment">/*&#32;first&#32;operand&#32;at&#32;top&#32;-&#32;2,&#32;second&#32;at&#32;top&#32;-&#32;1;&#32;result&#32;go&#32;to&#32;top&#32;-&#32;2&#32;*/</emphasis>
00321 &#32;&#32;<link linkend="_lobject_8c_1a70e6a84042c5cf25f3812cba16e1fc3d">luaO_arith</link>(L,&#32;op,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;2),&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;2);
00322 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;&#32;&#32;<emphasis role="comment">/*&#32;remove&#32;second&#32;operand&#32;*/</emphasis>
00323 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00324 }
00325 
00326 
<anchor xml:id="_lapi_8c_source_1l00327"/><link linkend="_lua_8h_1a603a5975f5a19c1824e6af53c1326b5c">00327</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a5fbae51f515549d4657d0efc676defee">lua_compare</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;index1,&#32;<emphasis role="keywordtype">int</emphasis>&#32;index2,&#32;<emphasis role="keywordtype">int</emphasis>&#32;op)&#32;{
00328 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o1;
00329 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o2;
00330 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;i&#32;=&#32;0;
00331 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);&#32;&#32;<emphasis role="comment">/*&#32;may&#32;call&#32;tag&#32;method&#32;*/</emphasis>
00332 &#32;&#32;o1&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;index1);
00333 &#32;&#32;o2&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;index2);
00334 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">isvalid</link>(L,&#32;o1)&#32;&amp;&amp;&#32;<link linkend="_lapi_8c_1aa414c9c792a81e37b5380c323b107194">isvalid</link>(L,&#32;o2))&#32;{
00335 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(op)&#32;{
00336 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1ac03b3a20eb47ae78f0ba9de673dbbc18">LUA_OPEQ</link>:&#32;i&#32;=&#32;<link linkend="_lvm_8c_1a4826066036eb5f7cf0f8a33f7073f49e">luaV_equalobj</link>(L,&#32;o1,&#32;o2);&#32;<emphasis role="keywordflow">break</emphasis>;
00337 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a0386da34771797273cad6b7a4b2ce53e">LUA_OPLT</link>:&#32;i&#32;=&#32;<link linkend="_lvm_8c_1a82cf4e4e2322eef8c4c53b98669e2ada">luaV_lessthan</link>(L,&#32;o1,&#32;o2);&#32;<emphasis role="keywordflow">break</emphasis>;
00338 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a110fe48591b6c46a89fdb0028a461717">LUA_OPLE</link>:&#32;i&#32;=&#32;<link linkend="_lvm_8c_1a03d32b640c60651c78bc5ae0f2bc0549">luaV_lessequal</link>(L,&#32;o1,&#32;o2);&#32;<emphasis role="keywordflow">break</emphasis>;
00339 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;0,&#32;<emphasis role="stringliteral">&quot;invalid&#32;option&quot;</emphasis>);
00340 &#32;&#32;&#32;&#32;}
00341 &#32;&#32;}
00342 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00343 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;i;
00344 }
00345 
00346 
<anchor xml:id="_lapi_8c_source_1l00347"/><link linkend="_lua_8h_1af4d885e44232f561cfc508a71e144f8f">00347</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">size_t</emphasis>&#32;<link linkend="_lapi_8c_1ab9c2fb9e2b2c7dad7474dd4b6f1bbcd0">lua_stringtonumber</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*s)&#32;{
00348 &#32;&#32;<emphasis role="keywordtype">size_t</emphasis>&#32;sz&#32;=&#32;<link linkend="_lobject_8c_1ab1956c979ca7ff39b07534390714505d">luaO_str2num</link>(s,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00349 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz&#32;!=&#32;0)
00350 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00351 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;sz;
00352 }
00353 
00354 
<anchor xml:id="_lapi_8c_source_1l00355"/><link linkend="_lua_8h_1a5da44cbd6acc89833d4941bf044989c3">00355</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1af0a6ed3b852d680769cfc410a0672172">lua_Number</link>&#32;<link linkend="_lapi_8c_1a375da41304604b0cba0b8c798499e673">lua_tonumberx</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;*pisnum)&#32;{
00356 &#32;&#32;<link linkend="_lua_8h_1af0a6ed3b852d680769cfc410a0672172">lua_Number</link>&#32;n&#32;=&#32;0;
00357 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00358 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;isnum&#32;=&#32;<link linkend="_lvm_8h_1af9edcc5da8ea1ac07ffdf79fbe5bb95c">tonumber</link>(o,&#32;&amp;n);
00359 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pisnum)
00360 &#32;&#32;&#32;&#32;*pisnum&#32;=&#32;isnum;
00361 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;n;
00362 }
00363 
00364 
<anchor xml:id="_lapi_8c_source_1l00365"/><link linkend="_lua_8h_1a46cfc259a847998dfaf2db69e3f4f9f8">00365</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;<link linkend="_lapi_8c_1af81c9a68425546e1f8c6354728c95170">lua_tointegerx</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;*pisnum)&#32;{
00366 &#32;&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;res&#32;=&#32;0;
00367 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00368 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;isnum&#32;=&#32;<link linkend="_lvm_8h_1aa0972161c02de57dbe993112eb5c5583">tointeger</link>(o,&#32;&amp;res);
00369 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pisnum)
00370 &#32;&#32;&#32;&#32;*pisnum&#32;=&#32;isnum;
00371 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
00372 }
00373 
00374 
<anchor xml:id="_lapi_8c_source_1l00375"/><link linkend="_lua_8h_1a0f530f104aeaddeeb63b27dc18b42d27">00375</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a444aee9aa56b0b06175ee3c7bcf7927c">lua_toboolean</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00376 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00377 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;!<link linkend="_lobject_8h_1a188e1a95c8c6d547a13431a6e1edd5b3">l_isfalse</link>(o);
00378 }
00379 
00380 
<anchor xml:id="_lapi_8c_source_1l00381"/><link linkend="_lua_8h_1aabf845b1c7ffc0462988b67ba83955cf">00381</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1a3fc7dbcac3f2610f3d687ec15343bd3f">lua_tolstring</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keywordtype">size_t</emphasis>&#32;*len)&#32;{
00382 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o;
00383 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00384 &#32;&#32;o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00385 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_lobject_8h_1a9bdf057a0de8da2ffae3ac35662dd255">ttisstring</link>(o))&#32;{
00386 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_lvm_8h_1aa6af30bdcb0dce1826c81061cec16d81">cvt2str</link>(o))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;not&#32;convertible?&#32;*/</emphasis>
00387 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(len&#32;!=&#32;NULL)&#32;*len&#32;=&#32;0;
00388 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00389 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;
00390 &#32;&#32;&#32;&#32;}
00391 &#32;&#32;&#32;&#32;<link linkend="_lobject_8c_1a53824ade5220a50d44148175f7787199">luaO_tostring</link>(L,&#32;o);
00392 &#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00393 &#32;&#32;&#32;&#32;o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);&#32;&#32;<emphasis role="comment">/*&#32;previous&#32;call&#32;may&#32;reallocate&#32;the&#32;stack&#32;*/</emphasis>
00394 &#32;&#32;}
00395 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(len&#32;!=&#32;NULL)
00396 &#32;&#32;&#32;&#32;*len&#32;=&#32;<link linkend="_lobject_8h_1a9753d5f343806e0cb16293f53143098c">vslen</link>(o);
00397 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00398 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1ac2c9eedf3ff2c3042445b3b534f161e1">svalue</link>(o);
00399 }
00400 
00401 
<anchor xml:id="_lapi_8c_source_1l00402"/><link linkend="_lua_8h_1a5185311c77540dbec9b192a16903f477">00402</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1a2357bdcd9af1aaef0a6895a9c3b7eccf">lua_Unsigned</link>&#32;<link linkend="_lapi_8c_1a161e2baf3d7a6a84499f6a9010cf12c8">lua_rawlen</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00403 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00404 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1a01db083f8bc8b2eb51a45c0ba9967043">ttypetag</link>(o))&#32;{
00405 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a794410ffd7267ef873eb05ac695b1ba6">LUA_VSHRSTR</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a8661397faed512ccc9c70a4661f1a83d">tsvalue</link>(o)-&gt;shrlen;
00406 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a6869fcb0a0178b6d70d431eae1683199">LUA_VLNGSTR</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a8661397faed512ccc9c70a4661f1a83d">tsvalue</link>(o)-&gt;u.lnglen;
00407 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1af45b44d4031e7e869195dd97759d2ca3">LUA_VUSERDATA</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(o)-&gt;len;
00408 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1afaf24d5b79b9027ad768d023778669df">LUA_VTABLE</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ltable_8c_1a94d8f30941967078b44e2e21c4dd9a75">luaH_getn</link>(<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(o));
00409 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
00410 &#32;&#32;}
00411 }
00412 
00413 
<anchor xml:id="_lapi_8c_source_1l00414"/><link linkend="_lua_8h_1a8c9a532a84b03d90b0a103c007f871b8">00414</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1a878b7e392e78661a374cf1c3073029b9">lua_CFunction</link>&#32;<link linkend="_lapi_8c_1ae790897a3311d599299895612986d850">lua_tocfunction</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00415 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00416 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a8d43f35dfc5fcd0ee49a6206d63bec18">ttislcf</link>(o))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a27d0b4b700445d8c82ddc634c0252d10">fvalue</link>(o);
00417 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a9510da9838a8f17b4eef364549a4c7a8">ttisCclosure</link>(o))
00418 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a2c2d10bdd241446b4c9e1b68268159bc">clCvalue</link>(o)-&gt;f;
00419 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;not&#32;a&#32;C&#32;function&#32;*/</emphasis>
00420 }
00421 
00422 
<anchor xml:id="_lapi_8c_source_1l00423"/><link linkend="_lapi_8c_1ae98ecd8a638f53798949d5966c0cbed4">00423</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*<link linkend="_lapi_8c_1ae98ecd8a638f53798949d5966c0cbed4">touserdata</link>&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o)&#32;{
00424 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(o))&#32;{
00425 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a2caa96489ffdf9759e50fda47d69f605">getudatamem</link>(<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(o));
00426 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1aa030c2d649070173902c8094d8e0e2cd">LUA_TLIGHTUSERDATA</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a16c0267c035b3e4edda082e25069e8cf">pvalue</link>(o);
00427 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;
00428 &#32;&#32;}
00429 }
00430 
00431 
<anchor xml:id="_lapi_8c_source_1l00432"/><link linkend="_lua_8h_1a3b3106346d9739a64d48be4e30368dec">00432</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*<link linkend="_lapi_8c_1a0444ddf13e5618bca969e4b3b47bc0cc">lua_touserdata</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00433 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00434 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1ae98ecd8a638f53798949d5966c0cbed4">touserdata</link>(o);
00435 }
00436 
00437 
<anchor xml:id="_lapi_8c_source_1l00438"/><link linkend="_lua_8h_1a8ad0bb2b578f5b6e84511431260a5818">00438</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_structlua___state">lua_State</link>&#32;*<link linkend="_lapi_8c_1ad1dcea410edb5c5595fc070f8bf2e9a0">lua_tothread</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00439 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00440 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(!<link linkend="_lobject_8h_1a5ae8a42aa33c44ef3c98fcda8b7ab4c5">ttisthread</link>(o))&#32;?&#32;NULL&#32;:&#32;<link linkend="_lobject_8h_1a516f32427f1c43ee187ce4c0db042959">thvalue</link>(o);
00441 }
00442 
00443 
00444 <emphasis role="comment">/*</emphasis>
00445 <emphasis role="comment">**&#32;Returns&#32;a&#32;pointer&#32;to&#32;the&#32;internal&#32;representation&#32;of&#32;an&#32;object.</emphasis>
00446 <emphasis role="comment">**&#32;Note&#32;that&#32;ANSI&#32;C&#32;does&#32;not&#32;allow&#32;the&#32;conversion&#32;of&#32;a&#32;pointer&#32;to</emphasis>
00447 <emphasis role="comment">**&#32;function&#32;to&#32;a&#32;&apos;void*&apos;,&#32;so&#32;the&#32;conversion&#32;here&#32;goes&#32;through</emphasis>
00448 <emphasis role="comment">**&#32;a&#32;&apos;size_t&apos;.&#32;(As&#32;the&#32;returned&#32;pointer&#32;is&#32;only&#32;informative,&#32;this</emphasis>
00449 <emphasis role="comment">**&#32;conversion&#32;should&#32;not&#32;be&#32;a&#32;problem.)</emphasis>
00450 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00451"/><link linkend="_lua_8h_1ae00a730cd408773f7a4122fccfbbb91a">00451</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*<link linkend="_lapi_8c_1a5b533fe96cb52b5415896d41daad374a">lua_topointer</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00452 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00453 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1a01db083f8bc8b2eb51a45c0ba9967043">ttypetag</link>(o))&#32;{
00454 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a9b9abbdd10fec20fc7a746efd903872d">LUA_VLCF</link>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_llimits_8h_1a672c0fddf71f33d86ed8aa62ad914d52">cast_voidp</link>(<link linkend="_llimits_8h_1a025d385a5ce274fa6eade82b6e1458d1">cast_sizet</link>(<link linkend="_lobject_8h_1a27d0b4b700445d8c82ddc634c0252d10">fvalue</link>(o)));
00455 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1af45b44d4031e7e869195dd97759d2ca3">LUA_VUSERDATA</link>:&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a0fe81163ea67e644d5a85078c4a6d25c">LUA_VLIGHTUSERDATA</link>:
00456 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1ae98ecd8a638f53798949d5966c0cbed4">touserdata</link>(o);
00457 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;{
00458 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1aaabdb414706e6a904461e39967557185">iscollectable</link>(o))
00459 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a05cdf6070135f10ad37e1048a730b634">gcvalue</link>(o);
00460 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>
00461 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;
00462 &#32;&#32;&#32;&#32;}
00463 &#32;&#32;}
00464 }
00465 
00466 
00467 
00468 <emphasis role="comment">/*</emphasis>
00469 <emphasis role="comment">**&#32;push&#32;functions&#32;(C&#32;-&gt;&#32;stack)</emphasis>
00470 <emphasis role="comment">*/</emphasis>
00471 
00472 
<anchor xml:id="_lapi_8c_source_1l00473"/><link linkend="_lua_8h_1a8bd9c4137a90833221f48dd16659c9e4">00473</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a1b4cd0d80f51e5545a97ca6c28c03c50">lua_pushnil</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L)&#32;{
00474 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00475 &#32;&#32;<link linkend="_lobject_8h_1ad9034def7bbc1965ec3d714d84620b07">setnilvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00476 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00477 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00478 }
00479 
00480 
<anchor xml:id="_lapi_8c_source_1l00481"/><link linkend="_lua_8h_1a77807056ba032d64b2def2b57dc53d53">00481</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a328625a03fbb5548f27b1af10f109f6a">lua_pushnumber</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1af0a6ed3b852d680769cfc410a0672172">lua_Number</link>&#32;n)&#32;{
00482 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00483 &#32;&#32;<link linkend="_lobject_8h_1ae357382324a8220a3cf77607752de887">setfltvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;n);
00484 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00485 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00486 }
00487 
00488 
<anchor xml:id="_lapi_8c_source_1l00489"/><link linkend="_lua_8h_1aea46fa9bf358947f5c0a1bf266b26154">00489</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1adcec46ff05dfee9a3c4c05828b40c213">lua_pushinteger</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;n)&#32;{
00490 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00491 &#32;&#32;<link linkend="_lobject_8h_1af9dd109ba186841ab26efb2d62baf4f6">setivalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;n);
00492 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00493 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00494 }
00495 
00496 
00497 <emphasis role="comment">/*</emphasis>
00498 <emphasis role="comment">**&#32;Pushes&#32;on&#32;the&#32;stack&#32;a&#32;string&#32;with&#32;given&#32;length.&#32;Avoid&#32;using&#32;&apos;s&apos;&#32;when</emphasis>
00499 <emphasis role="comment">**&#32;&apos;len&apos;&#32;==&#32;0&#32;(as&#32;&apos;s&apos;&#32;can&#32;be&#32;NULL&#32;in&#32;that&#32;case),&#32;due&#32;to&#32;later&#32;use&#32;of</emphasis>
00500 <emphasis role="comment">**&#32;&apos;memcmp&apos;&#32;and&#32;&apos;memcpy&apos;.</emphasis>
00501 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00502"/><link linkend="_lua_8h_1a48a8d31a66ddacf1ea049b980cf09ab2">00502</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1a2c325311534c23450cdf11931a8db0ae">lua_pushlstring</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*s,&#32;<emphasis role="keywordtype">size_t</emphasis>&#32;len)&#32;{
00503 &#32;&#32;<link linkend="_struct_t_string">TString</link>&#32;*ts;
00504 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00505 &#32;&#32;ts&#32;=&#32;(len&#32;==&#32;0)&#32;?&#32;<link linkend="_lstring_8c_1a6d47e53be6b8e58202bb927752f4824b">luaS_new</link>(L,&#32;<emphasis role="stringliteral">&quot;&quot;</emphasis>)&#32;:&#32;<link linkend="_lstring_8c_1ab41fb084ce3ea5e2779f6659ccc2484d">luaS_newlstr</link>(L,&#32;s,&#32;len);
00506 &#32;&#32;<link linkend="_lobject_8h_1aa60b4c3bb90063dcaa2f90e77d4a61f6">setsvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;ts);
00507 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00508 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00509 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00510 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1acb05d3ab238923581a9c629b8e11a6ac">getstr</link>(ts);
00511 }
00512 
00513 
<anchor xml:id="_lapi_8c_source_1l00514"/><link linkend="_lua_8h_1a341ab0333f0da3035bb3a1266b3bb41e">00514</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1a771d300f2e64b2197d1df9bf31660ebf">lua_pushstring</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*s)&#32;{
00515 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00516 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(s&#32;==&#32;NULL)
00517 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1ad9034def7bbc1965ec3d714d84620b07">setnilvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00518 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00519 &#32;&#32;&#32;&#32;<link linkend="_struct_t_string">TString</link>&#32;*ts;
00520 &#32;&#32;&#32;&#32;ts&#32;=&#32;<link linkend="_lstring_8c_1a6d47e53be6b8e58202bb927752f4824b">luaS_new</link>(L,&#32;s);
00521 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1aa60b4c3bb90063dcaa2f90e77d4a61f6">setsvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;ts);
00522 &#32;&#32;&#32;&#32;s&#32;=&#32;<link linkend="_lobject_8h_1acb05d3ab238923581a9c629b8e11a6ac">getstr</link>(ts);&#32;&#32;<emphasis role="comment">/*&#32;internal&#32;copy&apos;s&#32;address&#32;*/</emphasis>
00523 &#32;&#32;}
00524 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00525 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00526 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00527 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;s;
00528 }
00529 
00530 
<anchor xml:id="_lapi_8c_source_1l00531"/><link linkend="_lua_8h_1a13fb1100c2e3942aa6c69baaf7e3f7cd">00531</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1a426c9cb1d582be3e43060c4772854e5a">lua_pushvfstring</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*fmt,
00532 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;va_list&#32;argp)&#32;{
00533 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*ret;
00534 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00535 &#32;&#32;ret&#32;=&#32;<link linkend="_lobject_8c_1aa83fa444a36d79521e846a766fa083d5">luaO_pushvfstring</link>(L,&#32;fmt,&#32;argp);
00536 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00537 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00538 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ret;
00539 }
00540 
00541 
<anchor xml:id="_lapi_8c_source_1l00542"/><link linkend="_lua_8h_1af4a7bd8fa65e507e36aff61af8db117d">00542</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1ab190c226d38b289e6ca57683a9d4e0f0">lua_pushfstring</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*fmt,&#32;...)&#32;{
00543 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*ret;
00544 &#32;&#32;va_list&#32;argp;
00545 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00546 &#32;&#32;va_start(argp,&#32;fmt);
00547 &#32;&#32;ret&#32;=&#32;<link linkend="_lobject_8c_1aa83fa444a36d79521e846a766fa083d5">luaO_pushvfstring</link>(L,&#32;fmt,&#32;argp);
00548 &#32;&#32;va_end(argp);
00549 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00550 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00551 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ret;
00552 }
00553 
00554 
<anchor xml:id="_lapi_8c_source_1l00555"/><link linkend="_lua_8h_1a89f758ed8996c5f405cb7dfb41f78337">00555</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a142802b91cdd22516b54599f51e101e4">lua_pushcclosure</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a878b7e392e78661a374cf1c3073029b9">lua_CFunction</link>&#32;fn,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00556 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00557 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;0)&#32;{
00558 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1a449f6c91562897c555ff32b360a6042f">setfvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;fn);
00559 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00560 &#32;&#32;}
00561 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00562 &#32;&#32;&#32;&#32;<link linkend="_struct_c_closure">CClosure</link>&#32;*cl;
00563 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;n);
00564 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;n&#32;&lt;=&#32;<link linkend="_lfunc_8h_1ac5b64a112a390053ec98913b67b3f112">MAXUPVAL</link>,&#32;<emphasis role="stringliteral">&quot;upvalue&#32;index&#32;too&#32;large&quot;</emphasis>);
00565 &#32;&#32;&#32;&#32;cl&#32;=&#32;<link linkend="_lfunc_8c_1a13a7dac7822f88b00c962b57e97cc0ef">luaF_newCclosure</link>(L,&#32;n);
00566 &#32;&#32;&#32;&#32;cl-&gt;<link linkend="_struct_c_closure_1abaf5a162dadd891d6bbdf89025862c98">f</link>&#32;=&#32;fn;
00567 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-=&#32;n;
00568 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n--)&#32;{
00569 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1ad6d8d3d900cff1b02c3b269eabccccf9">setobj2n</link>(L,&#32;&amp;cl-&gt;<link linkend="_struct_c_closure_1a5d6ca5386d338c19af338be60a375dd4">upvalue</link>[n],&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;+&#32;n));
00570 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;does&#32;not&#32;need&#32;barrier&#32;because&#32;closure&#32;is&#32;white&#32;*/</emphasis>
00571 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1a5978f5fda715bd80e845df1e16ad7780">lua_assert</link>(<link linkend="_lgc_8h_1a4c0ce78d476460d2e54914301f4a4bf7">iswhite</link>(cl));
00572 &#32;&#32;&#32;&#32;}
00573 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1a57d9fee6a3a8d1eb4b36c95cf76ab09d">setclCvalue</link>(L,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;cl);
00574 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00575 &#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00576 &#32;&#32;}
00577 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00578 }
00579 
00580 
<anchor xml:id="_lapi_8c_source_1l00581"/><link linkend="_lua_8h_1a9d7bacf1769dcf7cff7ba7271041e61c">00581</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a56bbb7479265e38da2e2596e6ec25faa">lua_pushboolean</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;b)&#32;{
00582 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00583 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b)
00584 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1a1b86e0dccf6b92c4c89d47af26e3a8e3">setbtvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00585 &#32;&#32;<emphasis role="keywordflow">else</emphasis>
00586 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1ad0259526a10884432dd2e7ea10b90e0f">setbfvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00587 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00588 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00589 }
00590 
00591 
<anchor xml:id="_lapi_8c_source_1l00592"/><link linkend="_lua_8h_1a9d6c960026cbee9ffb95a9d1753675e2">00592</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a85e3e3d32b068aef62426828a104b561">lua_pushlightuserdata</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*p)&#32;{
00593 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00594 &#32;&#32;<link linkend="_lobject_8h_1a0784c90d154ccf7c643b56a00c62412a">setpvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;p);
00595 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00596 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00597 }
00598 
00599 
<anchor xml:id="_lapi_8c_source_1l00600"/><link linkend="_lua_8h_1a118bd9effa8d54ddcbe37bd5cb70a4b6">00600</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a4175aeea9aa6dbf096ecfca7b190fa4a">lua_pushthread</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L)&#32;{
00601 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00602 &#32;&#32;<link linkend="_lobject_8h_1a9c2bad449e8e998bb9d937642923a225">setthvalue</link>(L,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;L);
00603 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00604 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00605 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;mainthread&#32;==&#32;L);
00606 }
00607 
00608 
00609 
00610 <emphasis role="comment">/*</emphasis>
00611 <emphasis role="comment">**&#32;get&#32;functions&#32;(Lua&#32;-&gt;&#32;stack)</emphasis>
00612 <emphasis role="comment">*/</emphasis>
00613 
00614 
<anchor xml:id="_lapi_8c_source_1l00615"/><link linkend="_lapi_8c_1a1b28b3a312121ffb29541632648b9f78">00615</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a1b28b3a312121ffb29541632648b9f78">auxgetstr</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*k)&#32;{
00616 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00617 &#32;&#32;<link linkend="_struct_t_string">TString</link>&#32;*str&#32;=&#32;<link linkend="_lstring_8c_1a6d47e53be6b8e58202bb927752f4824b">luaS_new</link>(L,&#32;k);
00618 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lvm_8h_1a16d42351ed7a1d0c0c1677bdfd3b123b">luaV_fastget</link>(L,&#32;t,&#32;str,&#32;slot,&#32;<link linkend="_ltable_8c_1ae273e09d2342a84f5cdfa976c66f28c0">luaH_getstr</link>))&#32;{
00619 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;slot);
00620 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00621 &#32;&#32;}
00622 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00623 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1aa60b4c3bb90063dcaa2f90e77d4a61f6">setsvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;str);
00624 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00625 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a45c30a70c51ed843f58bd446aa2096c9">luaV_finishget</link>(L,&#32;t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1,&#32;slot);
00626 &#32;&#32;}
00627 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00628 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00629 }
00630 
00631 
<anchor xml:id="_lapi_8c_source_1l00632"/><link linkend="_lua_8h_1aed0bba8f94a9dc573ac77becd0f0c5e9">00632</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a8185a9c46d5930205f95beee4991e9f0">lua_getglobal</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*name)&#32;{
00633 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*reg;
00634 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00635 &#32;&#32;reg&#32;=&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;l_registry);
00636 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1a1b28b3a312121ffb29541632648b9f78">auxgetstr</link>(L,&#32;<link linkend="_ltable_8c_1ae142cefd44452389877c3e3187c7973e">luaH_getint</link>(reg,&#32;<link linkend="_lua_8h_1a08ad697e382a0042a439bc9748fa2d8c">LUA_RIDX_GLOBALS</link>),&#32;name);
00637 }
00638 
00639 
<anchor xml:id="_lapi_8c_source_1l00640"/><link linkend="_lua_8h_1aaf6927ff4c73814c84d8ffca44d2fda6">00640</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aa572dbc6e86f796a3e82ffcae4478aeb">lua_gettable</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00641 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00642 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t;
00643 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00644 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00645 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lvm_8h_1a16d42351ed7a1d0c0c1677bdfd3b123b">luaV_fastget</link>(L,&#32;t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;slot,&#32;<link linkend="_ltable_8c_1a8b4fce00d7db27ee9caac3d49863dea3">luaH_get</link>))&#32;{
00646 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1,&#32;slot);
00647 &#32;&#32;}
00648 &#32;&#32;<emphasis role="keywordflow">else</emphasis>
00649 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a45c30a70c51ed843f58bd446aa2096c9">luaV_finishget</link>(L,&#32;t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1,&#32;slot);
00650 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00651 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00652 }
00653 
00654 
<anchor xml:id="_lapi_8c_source_1l00655"/><link linkend="_lua_8h_1aa97386935b690dd478abd7c6fb89bef8">00655</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a8b47f1b5685c3f8018ba926abb99af24">lua_getfield</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*k)&#32;{
00656 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00657 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1a1b28b3a312121ffb29541632648b9f78">auxgetstr</link>(L,&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx),&#32;k);
00658 }
00659 
00660 
<anchor xml:id="_lapi_8c_source_1l00661"/><link linkend="_lua_8h_1aa61540e05598186dd6afb26e0f37716c">00661</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a631ebda324b6a0f382ab6b9314917384">lua_geti</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;n)&#32;{
00662 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t;
00663 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00664 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00665 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00666 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lvm_8h_1a1caa2d08a594618bae645c93d3e21a56">luaV_fastgeti</link>(L,&#32;t,&#32;n,&#32;slot))&#32;{
00667 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;slot);
00668 &#32;&#32;}
00669 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00670 &#32;&#32;&#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;aux;
00671 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1af9dd109ba186841ab26efb2d62baf4f6">setivalue</link>(&amp;aux,&#32;n);
00672 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a45c30a70c51ed843f58bd446aa2096c9">luaV_finishget</link>(L,&#32;t,&#32;&amp;aux,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;slot);
00673 &#32;&#32;}
00674 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00675 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00676 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00677 }
00678 
00679 
<anchor xml:id="_lapi_8c_source_1l00680"/><link linkend="_lapi_8c_1a33830676158a2e9fde44f07109035425">00680</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a33830676158a2e9fde44f07109035425">finishrawget</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*val)&#32;{
00681 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a5345ae49ed16dfecdfef95ec5399b000">isempty</link>(val))&#32;&#32;<emphasis role="comment">/*&#32;avoid&#32;copying&#32;empty&#32;items&#32;to&#32;the&#32;stack&#32;*/</emphasis>
00682 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1ad9034def7bbc1965ec3d714d84620b07">setnilvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00683 &#32;&#32;<emphasis role="keywordflow">else</emphasis>
00684 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;val);
00685 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00686 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00687 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00688 }
00689 
00690 
<anchor xml:id="_lapi_8c_source_1l00691"/><link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">00691</link> <emphasis role="keyword">static</emphasis>&#32;<link linkend="_struct_table">Table</link>&#32;*<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00692 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00693 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lobject_8h_1ac5338f5fe3885d1ee65412e00a44384e">ttistable</link>(t),&#32;<emphasis role="stringliteral">&quot;table&#32;expected&quot;</emphasis>);
00694 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(t);
00695 }
00696 
00697 
<anchor xml:id="_lapi_8c_source_1l00698"/><link linkend="_lua_8h_1ae8f0d7f0543fcfe008d5ab1bab1fcd21">00698</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a52944e714d1c64bda7b83f511c14b2d3">lua_rawget</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00699 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
00700 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*val;
00701 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00702 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00703 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>(L,&#32;idx);
00704 &#32;&#32;val&#32;=&#32;<link linkend="_ltable_8c_1a8b4fce00d7db27ee9caac3d49863dea3">luaH_get</link>(t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00705 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;&#32;&#32;<emphasis role="comment">/*&#32;remove&#32;key&#32;*/</emphasis>
00706 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1a33830676158a2e9fde44f07109035425">finishrawget</link>(L,&#32;val);
00707 }
00708 
00709 
<anchor xml:id="_lapi_8c_source_1l00710"/><link linkend="_lua_8h_1a4cb16fd79ac268b68742136d6db8d288">00710</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1af8e4dc545cc83927d901d2f242489320">lua_rawgeti</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;n)&#32;{
00711 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
00712 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00713 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>(L,&#32;idx);
00714 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1a33830676158a2e9fde44f07109035425">finishrawget</link>(L,&#32;<link linkend="_ltable_8c_1ae142cefd44452389877c3e3187c7973e">luaH_getint</link>(t,&#32;n));
00715 }
00716 
00717 
<anchor xml:id="_lapi_8c_source_1l00718"/><link linkend="_lua_8h_1a8aaccfd5ff3c7acbbd8a48f325a0b779">00718</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1acf10870c7165e0e440eb14827a52de93">lua_rawgetp</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*p)&#32;{
00719 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
00720 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;k;
00721 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00722 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>(L,&#32;idx);
00723 &#32;&#32;<link linkend="_lobject_8h_1a0784c90d154ccf7c643b56a00c62412a">setpvalue</link>(&amp;k,&#32;<link linkend="_llimits_8h_1a672c0fddf71f33d86ed8aa62ad914d52">cast_voidp</link>(p));
00724 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lapi_8c_1a33830676158a2e9fde44f07109035425">finishrawget</link>(L,&#32;<link linkend="_ltable_8c_1a8b4fce00d7db27ee9caac3d49863dea3">luaH_get</link>(t,&#32;&amp;k));
00725 }
00726 
00727 
<anchor xml:id="_lapi_8c_source_1l00728"/><link linkend="_lua_8h_1a022ddaeee46ccb89860c78480e54db05">00728</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a7f93e3baf3101cad59ec61b7744a55d8">lua_createtable</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;narray,&#32;<emphasis role="keywordtype">int</emphasis>&#32;nrec)&#32;{
00729 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
00730 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00731 &#32;&#32;t&#32;=&#32;<link linkend="_ltable_8c_1a6c97fb2d6a020b0a6f852562fef93d97">luaH_new</link>(L);
00732 &#32;&#32;<link linkend="_lobject_8h_1aea789832f6c549f64cb3903216a7aeac">sethvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;t);
00733 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00734 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(narray&#32;&gt;&#32;0&#32;||&#32;nrec&#32;&gt;&#32;0)
00735 &#32;&#32;&#32;&#32;<link linkend="_ltable_8c_1aad3b771962cc13884bf7b45480e8f4e9">luaH_resize</link>(L,&#32;t,&#32;narray,&#32;nrec);
00736 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
00737 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00738 }
00739 
00740 
<anchor xml:id="_lapi_8c_source_1l00741"/><link linkend="_lua_8h_1a15b983a1c2fd3c7ab7810c4aa0096567">00741</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a4caa9ca5e47a30bd45e33d83bf2d6d6e">lua_getmetatable</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;objindex)&#32;{
00742 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*obj;
00743 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*mt;
00744 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;res&#32;=&#32;0;
00745 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00746 &#32;&#32;obj&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;objindex);
00747 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(obj))&#32;{
00748 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a31620fd8da5b655b7879e16a116ec31a">LUA_TTABLE</link>:
00749 &#32;&#32;&#32;&#32;&#32;&#32;mt&#32;=&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(obj)-&gt;metatable;
00750 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
00751 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</link>:
00752 &#32;&#32;&#32;&#32;&#32;&#32;mt&#32;=&#32;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(obj)-&gt;metatable;
00753 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
00754 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:
00755 &#32;&#32;&#32;&#32;&#32;&#32;mt&#32;=&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;mt[<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(obj)];
00756 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
00757 &#32;&#32;}
00758 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mt&#32;!=&#32;NULL)&#32;{
00759 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1aea789832f6c549f64cb3903216a7aeac">sethvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;mt);
00760 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00761 &#32;&#32;&#32;&#32;res&#32;=&#32;1;
00762 &#32;&#32;}
00763 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00764 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
00765 }
00766 
00767 
<anchor xml:id="_lapi_8c_source_1l00768"/><link linkend="_lua_8h_1ab60a0f9aae241a62868972a2e606aff8">00768</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a57c21a629f94ee0acc21a25d83bfaeba">lua_getiuservalue</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00769 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o;
00770 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;t;
00771 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00772 &#32;&#32;o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00773 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lobject_8h_1a2b0d95af67f53d9fe2bdde605f9cd957">ttisfulluserdata</link>(o),&#32;<emphasis role="stringliteral">&quot;full&#32;userdata&#32;expected&quot;</emphasis>);
00774 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&lt;=&#32;0&#32;||&#32;n&#32;&gt;&#32;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(o)-&gt;nuvalue)&#32;{
00775 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1ad9034def7bbc1965ec3d714d84620b07">setnilvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00776 &#32;&#32;&#32;&#32;t&#32;=&#32;<link linkend="_lua_8h_1a39c27eef097c704eee3536906dea5380">LUA_TNONE</link>;
00777 &#32;&#32;}
00778 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00779 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;&amp;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(o)-&gt;uv[n&#32;-&#32;1].uv);
00780 &#32;&#32;&#32;&#32;t&#32;=&#32;<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
00781 &#32;&#32;}
00782 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00783 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00784 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;t;
00785 }
00786 
00787 
00788 <emphasis role="comment">/*</emphasis>
00789 <emphasis role="comment">**&#32;set&#32;functions&#32;(stack&#32;-&gt;&#32;Lua)</emphasis>
00790 <emphasis role="comment">*/</emphasis>
00791 
00792 <emphasis role="comment">/*</emphasis>
00793 <emphasis role="comment">**&#32;t[k]&#32;=&#32;value&#32;at&#32;the&#32;top&#32;of&#32;the&#32;stack&#32;(where&#32;&apos;k&apos;&#32;is&#32;a&#32;string)</emphasis>
00794 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00795"/><link linkend="_lapi_8c_1a0667fbf88666853554967226d9a3df4d">00795</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a0667fbf88666853554967226d9a3df4d">auxsetstr</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*k)&#32;{
00796 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00797 &#32;&#32;<link linkend="_struct_t_string">TString</link>&#32;*str&#32;=&#32;<link linkend="_lstring_8c_1a6d47e53be6b8e58202bb927752f4824b">luaS_new</link>(L,&#32;k);
00798 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00799 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lvm_8h_1a16d42351ed7a1d0c0c1677bdfd3b123b">luaV_fastget</link>(L,&#32;t,&#32;str,&#32;slot,&#32;<link linkend="_ltable_8c_1ae273e09d2342a84f5cdfa976c66f28c0">luaH_getstr</link>))&#32;{
00800 &#32;&#32;&#32;&#32;<link linkend="_lvm_8h_1a432c22e13223409ad55ed6c3aec12bcb">luaV_finishfastset</link>(L,&#32;t,&#32;slot,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00801 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;&#32;&#32;<emphasis role="comment">/*&#32;pop&#32;value&#32;*/</emphasis>
00802 &#32;&#32;}
00803 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00804 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1aa60b4c3bb90063dcaa2f90e77d4a61f6">setsvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;str);&#32;&#32;<emphasis role="comment">/*&#32;push&#32;&apos;str&apos;&#32;(to&#32;make&#32;it&#32;a&#32;TValue)&#32;*/</emphasis>
00805 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
00806 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a190116824dc13c5d37a6b2962f425a0d">luaV_finishset</link>(L,&#32;t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;2),&#32;slot);
00807 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-=&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;pop&#32;value&#32;and&#32;key&#32;*/</emphasis>
00808 &#32;&#32;}
00809 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);&#32;&#32;<emphasis role="comment">/*&#32;lock&#32;done&#32;by&#32;caller&#32;*/</emphasis>
00810 }
00811 
00812 
<anchor xml:id="_lapi_8c_source_1l00813"/><link linkend="_lua_8h_1a8da855aa334f38b822cbaceda0d633be">00813</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1aecf388efaede9d97581335998dfa243b">lua_setglobal</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*name)&#32;{
00814 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*reg;
00815 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);&#32;&#32;<emphasis role="comment">/*&#32;unlock&#32;done&#32;in&#32;&apos;auxsetstr&apos;&#32;*/</emphasis>
00816 &#32;&#32;reg&#32;=&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;l_registry);
00817 &#32;&#32;<link linkend="_lapi_8c_1a0667fbf88666853554967226d9a3df4d">auxsetstr</link>(L,&#32;<link linkend="_ltable_8c_1ae142cefd44452389877c3e3187c7973e">luaH_getint</link>(reg,&#32;<link linkend="_lua_8h_1a08ad697e382a0042a439bc9748fa2d8c">LUA_RIDX_GLOBALS</link>),&#32;name);
00818 }
00819 
00820 
<anchor xml:id="_lapi_8c_source_1l00821"/><link linkend="_lua_8h_1aeda173d104e3a566ccaac89a1f64a5eb">00821</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a4ca492cf3d2194aec9a6292708bf66c8">lua_settable</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00822 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t;
00823 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00824 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00825 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;2);
00826 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00827 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lvm_8h_1a16d42351ed7a1d0c0c1677bdfd3b123b">luaV_fastget</link>(L,&#32;t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;2),&#32;slot,&#32;<link linkend="_ltable_8c_1a8b4fce00d7db27ee9caac3d49863dea3">luaH_get</link>))&#32;{
00828 &#32;&#32;&#32;&#32;<link linkend="_lvm_8h_1a432c22e13223409ad55ed6c3aec12bcb">luaV_finishfastset</link>(L,&#32;t,&#32;slot,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00829 &#32;&#32;}
00830 &#32;&#32;<emphasis role="keywordflow">else</emphasis>
00831 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a190116824dc13c5d37a6b2962f425a0d">luaV_finishset</link>(L,&#32;t,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;2),&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;slot);
00832 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-=&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;pop&#32;index&#32;and&#32;value&#32;*/</emphasis>
00833 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00834 }
00835 
00836 
<anchor xml:id="_lapi_8c_source_1l00837"/><link linkend="_lua_8h_1a9580a15c141cbe4bf2a63fea625c3878">00837</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a3f2f542ee6728d82e51b1c302f9606df">lua_setfield</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*k)&#32;{
00838 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);&#32;&#32;<emphasis role="comment">/*&#32;unlock&#32;done&#32;in&#32;&apos;auxsetstr&apos;&#32;*/</emphasis>
00839 &#32;&#32;<link linkend="_lapi_8c_1a0667fbf88666853554967226d9a3df4d">auxsetstr</link>(L,&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx),&#32;k);
00840 }
00841 
00842 
<anchor xml:id="_lapi_8c_source_1l00843"/><link linkend="_lua_8h_1a12ba17fc94b8cf0122aa367170688453">00843</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a3f995c6cbc03d4cdebb2a6fc6fa11e59">lua_seti</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;n)&#32;{
00844 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t;
00845 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00846 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00847 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00848 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00849 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lvm_8h_1a1caa2d08a594618bae645c93d3e21a56">luaV_fastgeti</link>(L,&#32;t,&#32;n,&#32;slot))&#32;{
00850 &#32;&#32;&#32;&#32;<link linkend="_lvm_8h_1a432c22e13223409ad55ed6c3aec12bcb">luaV_finishfastset</link>(L,&#32;t,&#32;slot,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00851 &#32;&#32;}
00852 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00853 &#32;&#32;&#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;aux;
00854 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1af9dd109ba186841ab26efb2d62baf4f6">setivalue</link>(&amp;aux,&#32;n);
00855 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a190116824dc13c5d37a6b2962f425a0d">luaV_finishset</link>(L,&#32;t,&#32;&amp;aux,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1),&#32;slot);
00856 &#32;&#32;}
00857 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;&#32;&#32;<emphasis role="comment">/*&#32;pop&#32;value&#32;*/</emphasis>
00858 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00859 }
00860 
00861 
<anchor xml:id="_lapi_8c_source_1l00862"/><link linkend="_lapi_8c_1af95fcf06d620f6a244caf0097e610a07">00862</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1af95fcf06d620f6a244caf0097e610a07">aux_rawset</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<link linkend="_struct_t_value">TValue</link>&#32;*key,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00863 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
00864 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*slot;
00865 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00866 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;n);
00867 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>(L,&#32;idx);
00868 &#32;&#32;slot&#32;=&#32;<link linkend="_ltable_8c_1ab6b8518d8099b17f3ef58df047237fba">luaH_set</link>(L,&#32;t,&#32;key);
00869 &#32;&#32;<link linkend="_lobject_8h_1adefdd17d98f1f5734ee296395e1805d4">setobj2t</link>(L,&#32;slot,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00870 &#32;&#32;<link linkend="_ltable_8h_1a69534d37fbaf464430636bf437108530">invalidateTMcache</link>(t);
00871 &#32;&#32;<link linkend="_lgc_8h_1a60903f232a1c51d22de556ea4c144f3a">luaC_barrierback</link>(L,&#32;<link linkend="_lstate_8h_1a254ca29aba03e47440082d4591a9734e">obj2gco</link>(t),&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00872 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-=&#32;n;
00873 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00874 }
00875 
00876 
<anchor xml:id="_lapi_8c_source_1l00877"/><link linkend="_lua_8h_1a3db5cd3ce7ae703c39d54495be44aafc">00877</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1afb2d27f421677ef40425f9054ae216a7">lua_rawset</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
00878 &#32;&#32;<link linkend="_lapi_8c_1af95fcf06d620f6a244caf0097e610a07">aux_rawset</link>(L,&#32;idx,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;2),&#32;2);
00879 }
00880 
00881 
<anchor xml:id="_lapi_8c_source_1l00882"/><link linkend="_lua_8h_1ab919ec94612961d8ca6eebaddd43c5f6">00882</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1aef5ff7d32a6e275fa0b8305f013bee9d">lua_rawsetp</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*p)&#32;{
00883 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;k;
00884 &#32;&#32;<link linkend="_lobject_8h_1a0784c90d154ccf7c643b56a00c62412a">setpvalue</link>(&amp;k,&#32;<link linkend="_llimits_8h_1a672c0fddf71f33d86ed8aa62ad914d52">cast_voidp</link>(p));
00885 &#32;&#32;<link linkend="_lapi_8c_1af95fcf06d620f6a244caf0097e610a07">aux_rawset</link>(L,&#32;idx,&#32;&amp;k,&#32;1);
00886 }
00887 
00888 
<anchor xml:id="_lapi_8c_source_1l00889"/><link linkend="_lua_8h_1a5e58b5585938f5b4eac93d8dc2c3348c">00889</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a757fd16e7e09280e2d4e4f9f77ba1099">lua_rawseti</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<link linkend="_lua_8h_1a362144baa0cfb14dc38fd21438053d73">lua_Integer</link>&#32;n)&#32;{
00890 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
00891 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00892 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00893 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>(L,&#32;idx);
00894 &#32;&#32;<link linkend="_ltable_8c_1a9eefa8191c63f55cffb6b7b58217467c">luaH_setint</link>(L,&#32;t,&#32;n,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00895 &#32;&#32;<link linkend="_lgc_8h_1a60903f232a1c51d22de556ea4c144f3a">luaC_barrierback</link>(L,&#32;<link linkend="_lstate_8h_1a254ca29aba03e47440082d4591a9734e">obj2gco</link>(t),&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00896 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;
00897 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00898 }
00899 
00900 
<anchor xml:id="_lapi_8c_source_1l00901"/><link linkend="_lua_8h_1a0b834b6a9cd96b141385df14bd0272a4">00901</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a15719ea4119bdf5b3f2a406534431a7e">lua_setmetatable</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;objindex)&#32;{
00902 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*obj;
00903 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*mt;
00904 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00905 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00906 &#32;&#32;obj&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;objindex);
00907 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a39af019fafa202841da3bf7c427bf090">ttisnil</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1)))
00908 &#32;&#32;&#32;&#32;mt&#32;=&#32;NULL;
00909 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00910 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lobject_8h_1ac5338f5fe3885d1ee65412e00a44384e">ttistable</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1)),&#32;<emphasis role="stringliteral">&quot;table&#32;expected&quot;</emphasis>);
00911 &#32;&#32;&#32;&#32;mt&#32;=&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00912 &#32;&#32;}
00913 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(obj))&#32;{
00914 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a31620fd8da5b655b7879e16a116ec31a">LUA_TTABLE</link>:&#32;{
00915 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(obj)-&gt;metatable&#32;=&#32;mt;
00916 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mt)&#32;{
00917 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a90ac4f3c7085a418025edcc7215e8983">luaC_objbarrier</link>(L,&#32;<link linkend="_lobject_8h_1a05cdf6070135f10ad37e1048a730b634">gcvalue</link>(obj),&#32;mt);
00918 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8c_1a0d4f5fb6a8831817e117cfff473aeb0e">luaC_checkfinalizer</link>(L,&#32;<link linkend="_lobject_8h_1a05cdf6070135f10ad37e1048a730b634">gcvalue</link>(obj),&#32;mt);
00919 &#32;&#32;&#32;&#32;&#32;&#32;}
00920 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
00921 &#32;&#32;&#32;&#32;}
00922 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a84fd4c52cea4073671a4cd0eb7026dc7">LUA_TUSERDATA</link>:&#32;{
00923 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(obj)-&gt;metatable&#32;=&#32;mt;
00924 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mt)&#32;{
00925 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a90ac4f3c7085a418025edcc7215e8983">luaC_objbarrier</link>(L,&#32;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(obj),&#32;mt);
00926 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8c_1a0d4f5fb6a8831817e117cfff473aeb0e">luaC_checkfinalizer</link>(L,&#32;<link linkend="_lobject_8h_1a05cdf6070135f10ad37e1048a730b634">gcvalue</link>(obj),&#32;mt);
00927 &#32;&#32;&#32;&#32;&#32;&#32;}
00928 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
00929 &#32;&#32;&#32;&#32;}
00930 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;{
00931 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;mt[<link linkend="_lobject_8h_1acd205ab396b96fba48e1f758c17a2cf3">ttype</link>(obj)]&#32;=&#32;mt;
00932 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
00933 &#32;&#32;&#32;&#32;}
00934 &#32;&#32;}
00935 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;
00936 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00937 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
00938 }
00939 
00940 
<anchor xml:id="_lapi_8c_source_1l00941"/><link linkend="_lua_8h_1a276937f1e400751decda710e59fa1913">00941</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a7383d0f43ccf69b414217a32d3947a49">lua_setiuservalue</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
00942 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o;
00943 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;res;
00944 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00945 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
00946 &#32;&#32;o&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
00947 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lobject_8h_1a2b0d95af67f53d9fe2bdde605f9cd957">ttisfulluserdata</link>(o),&#32;<emphasis role="stringliteral">&quot;full&#32;userdata&#32;expected&quot;</emphasis>);
00948 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(<link linkend="_llimits_8h_1a6ce2ddc5b419ed6f302573db3cc03e56">cast_uint</link>(n)&#32;-&#32;1u&#32;&lt;&#32;<link linkend="_llimits_8h_1a6ce2ddc5b419ed6f302573db3cc03e56">cast_uint</link>(<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(o)-&gt;nuvalue)))
00949 &#32;&#32;&#32;&#32;res&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;&apos;n&apos;&#32;not&#32;in&#32;[1,&#32;uvalue(o)-&gt;nuvalue]&#32;*/</emphasis>
00950 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00951 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1acf2af15f3d5cceca8e8870f96634bc2d">setobj</link>(L,&#32;&amp;<link linkend="_lobject_8h_1a1c49f55d93297e833141fb62903af3ad">uvalue</link>(o)-&gt;uv[n&#32;-&#32;1].uv,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00952 &#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a60903f232a1c51d22de556ea4c144f3a">luaC_barrierback</link>(L,&#32;<link linkend="_lobject_8h_1a05cdf6070135f10ad37e1048a730b634">gcvalue</link>(o),&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));
00953 &#32;&#32;&#32;&#32;res&#32;=&#32;1;
00954 &#32;&#32;}
00955 &#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;
00956 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00957 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
00958 }
00959 
00960 
00961 <emphasis role="comment">/*</emphasis>
00962 <emphasis role="comment">**&#32;&apos;load&apos;&#32;and&#32;&apos;call&apos;&#32;functions&#32;(run&#32;Lua&#32;code)</emphasis>
00963 <emphasis role="comment">*/</emphasis>
00964 
00965 
<anchor xml:id="_lapi_8c_source_1l00966"/><link linkend="_lapi_8c_1a6b76ec051caca9db7e44638873044e98">00966</link> <emphasis role="preprocessor">#define&#32;checkresults(L,na,nr)&#32;\</emphasis>
00967 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;api_check(L,&#32;(nr)&#32;==&#32;LUA_MULTRET&#32;||&#32;(L-&gt;ci-&gt;top&#32;-&#32;L-&gt;top&#32;&gt;=&#32;(nr)&#32;-&#32;(na)),&#32;\</emphasis>
00968 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&quot;results&#32;from&#32;function&#32;overflow&#32;current&#32;stack&#32;size&quot;)</emphasis>
00969 
00970 
<anchor xml:id="_lapi_8c_source_1l00971"/><link linkend="_lua_8h_1aeebb647cb91c051b1955fac1207de386">00971</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1ac5fef99e413a94e396b70b8263704ad3">lua_callk</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;nargs,&#32;<emphasis role="keywordtype">int</emphasis>&#32;nresults,
00972 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lua_8h_1a0c565e13b66764da08aa2c68fe4365f0">lua_KContext</link>&#32;ctx,&#32;<link linkend="_lua_8h_1a4bfd58d9192edfdcb7238de00bd0202c">lua_KFunction</link>&#32;k)&#32;{
00973 &#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;func;
00974 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
00975 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;k&#32;==&#32;NULL&#32;||&#32;!<link linkend="_lstate_8h_1a489eab424b094f54dd7f6b35e2cf68a2">isLua</link>(L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>),
00976 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;cannot&#32;use&#32;continuations&#32;inside&#32;hooks&quot;</emphasis>);
00977 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;nargs+1);
00978 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1ab7ebe75445d38e722cbc077aec768b14">status</link>&#32;==&#32;<link linkend="_lua_8h_1ab969ff78cb1b63efa2bba3bdfa6fff5c">LUA_OK</link>,&#32;<emphasis role="stringliteral">&quot;cannot&#32;do&#32;calls&#32;on&#32;non-normal&#32;thread&quot;</emphasis>);
00979 &#32;&#32;<link linkend="_lapi_8c_1a6b76ec051caca9db7e44638873044e98">checkresults</link>(L,&#32;nargs,&#32;nresults);
00980 &#32;&#32;func&#32;=&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;(nargs+1);
00981 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(k&#32;!=&#32;NULL&#32;&amp;&amp;&#32;<link linkend="_lstate_8h_1aab879b1429bb9a48168253ab32cd270b">yieldable</link>(L))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;need&#32;to&#32;prepare&#32;continuation?&#32;*/</emphasis>
00982 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1af8751782b1a040b075c25cef0acb484a">u</link>.<link linkend="_struct_call_info_1aba21e4c76e6138c45d71c23242c0fd31">c</link>.k&#32;=&#32;k;&#32;&#32;<emphasis role="comment">/*&#32;save&#32;continuation&#32;*/</emphasis>
00983 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1af8751782b1a040b075c25cef0acb484a">u</link>.<link linkend="_struct_call_info_1aba21e4c76e6138c45d71c23242c0fd31">c</link>.ctx&#32;=&#32;ctx;&#32;&#32;<emphasis role="comment">/*&#32;save&#32;context&#32;*/</emphasis>
00984 &#32;&#32;&#32;&#32;<link linkend="_ldo_8c_1a9a82cbe1919eb0104a7249d6d7764061">luaD_call</link>(L,&#32;func,&#32;nresults);&#32;&#32;<emphasis role="comment">/*&#32;do&#32;the&#32;call&#32;*/</emphasis>
00985 &#32;&#32;}
00986 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;&#32;<emphasis role="comment">/*&#32;no&#32;continuation&#32;or&#32;no&#32;yieldable&#32;*/</emphasis>
00987 &#32;&#32;&#32;&#32;<link linkend="_ldo_8c_1a61c0a0185ef5ae1493dad10027f4db7e">luaD_callnoyield</link>(L,&#32;func,&#32;nresults);&#32;&#32;<emphasis role="comment">/*&#32;just&#32;do&#32;the&#32;call&#32;*/</emphasis>
00988 &#32;&#32;<link linkend="_lapi_8h_1afd1f4a36958642707b7598a48c507599">adjustresults</link>(L,&#32;nresults);
00989 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
00990 }
00991 
00992 
00993 
00994 <emphasis role="comment">/*</emphasis>
00995 <emphasis role="comment">**&#32;Execute&#32;a&#32;protected&#32;call.</emphasis>
00996 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00997"/><link linkend="_struct_call_s">00997</link> <emphasis role="keyword">struct&#32;</emphasis><link linkend="_struct_call_s">CallS</link>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;data&#32;to&#32;&apos;f_call&apos;&#32;*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l00998"/><link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">00998</link> &#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>;
<anchor xml:id="_lapi_8c_source_1l00999"/><link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">00999</link> &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>;
01000 };
01001 
01002 
<anchor xml:id="_lapi_8c_source_1l01003"/><link linkend="_lapi_8c_1ac3926c93fb08234f9f47e24653124910">01003</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1ac3926c93fb08234f9f47e24653124910">f_call</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*ud)&#32;{
01004 &#32;&#32;<emphasis role="keyword">struct&#32;</emphasis><link linkend="_struct_call_s">CallS</link>&#32;*c&#32;=&#32;<link linkend="_llimits_8h_1af17d62ec9e237a7644de6b9b34a48a34">cast</link>(<emphasis role="keyword">struct</emphasis>&#32;<link linkend="_struct_call_s">CallS</link>&#32;*,&#32;ud);
01005 &#32;&#32;<link linkend="_ldo_8c_1a61c0a0185ef5ae1493dad10027f4db7e">luaD_callnoyield</link>(L,&#32;c-&gt;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>,&#32;c-&gt;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>);
01006 }
01007 
01008 
01009 
<anchor xml:id="_lapi_8c_source_1l01010"/><link linkend="_lua_8h_1ab03ab465d4ca870dc66e228b8dfd3f06">01010</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a624df4cb2312b762c4fb528ecc889385">lua_pcallk</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;nargs,&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>,&#32;<emphasis role="keywordtype">int</emphasis>&#32;errfunc,
01011 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lua_8h_1a0c565e13b66764da08aa2c68fe4365f0">lua_KContext</link>&#32;ctx,&#32;<link linkend="_lua_8h_1a4bfd58d9192edfdcb7238de00bd0202c">lua_KFunction</link>&#32;k)&#32;{
01012 &#32;&#32;<emphasis role="keyword">struct&#32;</emphasis><link linkend="_struct_call_s">CallS</link>&#32;c;
01013 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;status;
01014 &#32;&#32;ptrdiff_t&#32;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>;
01015 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01016 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;k&#32;==&#32;NULL&#32;||&#32;!<link linkend="_lstate_8h_1a489eab424b094f54dd7f6b35e2cf68a2">isLua</link>(L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>),
01017 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;cannot&#32;use&#32;continuations&#32;inside&#32;hooks&quot;</emphasis>);
01018 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;nargs+1);
01019 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1ab7ebe75445d38e722cbc077aec768b14">status</link>&#32;==&#32;<link linkend="_lua_8h_1ab969ff78cb1b63efa2bba3bdfa6fff5c">LUA_OK</link>,&#32;<emphasis role="stringliteral">&quot;cannot&#32;do&#32;calls&#32;on&#32;non-normal&#32;thread&quot;</emphasis>);
01020 &#32;&#32;<link linkend="_lapi_8c_1a6b76ec051caca9db7e44638873044e98">checkresults</link>(L,&#32;nargs,&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>);
01021 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(errfunc&#32;==&#32;0)
01022 &#32;&#32;&#32;&#32;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;=&#32;0;
01023 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
01024 &#32;&#32;&#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;o&#32;=&#32;<link linkend="_lapi_8c_1a7acfd65878b2f2c7529c788ce08d1949">index2stack</link>(L,&#32;errfunc);
01025 &#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lobject_8h_1a48587dcb78721d149d3184d0768f4950">ttisfunction</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(o)),&#32;<emphasis role="stringliteral">&quot;error&#32;handler&#32;must&#32;be&#32;a&#32;function&quot;</emphasis>);
01026 &#32;&#32;&#32;&#32;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;=&#32;<link linkend="_ldo_8h_1a3534573bbeec89c6dbdb3eae5a54f9b9">savestack</link>(L,&#32;o);
01027 &#32;&#32;}
01028 &#32;&#32;c.<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>&#32;=&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;(nargs+1);&#32;&#32;<emphasis role="comment">/*&#32;function&#32;to&#32;be&#32;called&#32;*/</emphasis>
01029 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(k&#32;==&#32;NULL&#32;||&#32;!<link linkend="_lstate_8h_1aab879b1429bb9a48168253ab32cd270b">yieldable</link>(L))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;no&#32;continuation&#32;or&#32;no&#32;yieldable?&#32;*/</emphasis>
01030 &#32;&#32;&#32;&#32;c.<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>&#32;=&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>;&#32;&#32;<emphasis role="comment">/*&#32;do&#32;a&#32;&apos;conventional&apos;&#32;protected&#32;call&#32;*/</emphasis>
01031 &#32;&#32;&#32;&#32;status&#32;=&#32;<link linkend="_ldo_8c_1a1ad7f845cc62b110e3fcc0ae187d7c85">luaD_pcall</link>(L,&#32;<link linkend="_lapi_8c_1ac3926c93fb08234f9f47e24653124910">f_call</link>,&#32;&amp;c,&#32;<link linkend="_ldo_8h_1a3534573bbeec89c6dbdb3eae5a54f9b9">savestack</link>(L,&#32;c.<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>),&#32;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>);
01032 &#32;&#32;}
01033 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;prepare&#32;continuation&#32;(call&#32;is&#32;already&#32;protected&#32;by&#32;&apos;resume&apos;)&#32;*/</emphasis>
01034 &#32;&#32;&#32;&#32;<link linkend="_struct_call_info">CallInfo</link>&#32;*ci&#32;=&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>;
01035 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1af8751782b1a040b075c25cef0acb484a">u</link>.<link linkend="_struct_call_info_1aba21e4c76e6138c45d71c23242c0fd31">c</link>.k&#32;=&#32;k;&#32;&#32;<emphasis role="comment">/*&#32;save&#32;continuation&#32;*/</emphasis>
01036 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1af8751782b1a040b075c25cef0acb484a">u</link>.<link linkend="_struct_call_info_1aba21e4c76e6138c45d71c23242c0fd31">c</link>.ctx&#32;=&#32;ctx;&#32;&#32;<emphasis role="comment">/*&#32;save&#32;context&#32;*/</emphasis>
01037 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;save&#32;information&#32;for&#32;error&#32;recovery&#32;*/</emphasis>
01038 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1aa37fb5c5c84e9d8c8d810a4712381dcd">u2</link>.<link linkend="_struct_call_info_1ab3acb99c997e6556834d3646b44f3c85">funcidx</link>&#32;=&#32;<link linkend="_llimits_8h_1a37a9e2c4b53433d34bad0f12a1500c08">cast_int</link>(<link linkend="_ldo_8h_1a3534573bbeec89c6dbdb3eae5a54f9b9">savestack</link>(L,&#32;c.<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>));
01039 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1af8751782b1a040b075c25cef0acb484a">u</link>.<link linkend="_struct_call_info_1aba21e4c76e6138c45d71c23242c0fd31">c</link>.old_errfunc&#32;=&#32;L-&gt;<link linkend="_structlua___state_1acd673156213ded9f5159d761e9db2bc3">errfunc</link>;
01040 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1acd673156213ded9f5159d761e9db2bc3">errfunc</link>&#32;=&#32;<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>;
01041 &#32;&#32;&#32;&#32;<link linkend="_lstate_8h_1a77033f2cdcc8950b8961e2a413c9117b">setoah</link>(ci-&gt;<link linkend="_struct_call_info_1a1551d635e86dcf5c62f9bc718512d89b">callstatus</link>,&#32;L-&gt;<link linkend="_structlua___state_1ae027b098c1d274d696f69fdac344e236">allowhook</link>);&#32;&#32;<emphasis role="comment">/*&#32;save&#32;value&#32;of&#32;&apos;allowhook&apos;&#32;*/</emphasis>
01042 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1a1551d635e86dcf5c62f9bc718512d89b">callstatus</link>&#32;|=&#32;<link linkend="_lstate_8h_1a4b2deea0fb7c8f4b21151e5f105de6dc">CIST_YPCALL</link>;&#32;&#32;<emphasis role="comment">/*&#32;function&#32;can&#32;do&#32;error&#32;recovery&#32;*/</emphasis>
01043 &#32;&#32;&#32;&#32;<link linkend="_ldo_8c_1a9a82cbe1919eb0104a7249d6d7764061">luaD_call</link>(L,&#32;c.<link linkend="_struct_call_s_1a9d82a8ad04b0dd8837e621047972260a">func</link>,&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>);&#32;&#32;<emphasis role="comment">/*&#32;do&#32;the&#32;call&#32;*/</emphasis>
01044 &#32;&#32;&#32;&#32;ci-&gt;<link linkend="_struct_call_info_1a1551d635e86dcf5c62f9bc718512d89b">callstatus</link>&#32;&amp;=&#32;~<link linkend="_lstate_8h_1a4b2deea0fb7c8f4b21151e5f105de6dc">CIST_YPCALL</link>;
01045 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1acd673156213ded9f5159d761e9db2bc3">errfunc</link>&#32;=&#32;ci-&gt;<link linkend="_struct_call_info_1af8751782b1a040b075c25cef0acb484a">u</link>.<link linkend="_struct_call_info_1aba21e4c76e6138c45d71c23242c0fd31">c</link>.old_errfunc;
01046 &#32;&#32;&#32;&#32;status&#32;=&#32;<link linkend="_lua_8h_1ab969ff78cb1b63efa2bba3bdfa6fff5c">LUA_OK</link>;&#32;&#32;<emphasis role="comment">/*&#32;if&#32;it&#32;is&#32;here,&#32;there&#32;were&#32;no&#32;errors&#32;*/</emphasis>
01047 &#32;&#32;}
01048 &#32;&#32;<link linkend="_lapi_8h_1afd1f4a36958642707b7598a48c507599">adjustresults</link>(L,&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>);
01049 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01050 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;status;
01051 }
01052 
01053 
<anchor xml:id="_lapi_8c_source_1l01054"/><link linkend="_lua_8h_1a3f4c1ed5e0bd437dc527d62c5768b463">01054</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aa7a94c45f3eec251e5b258d7482ffe87">lua_load</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a4081d57135fee907807ba5070d528fdf">lua_Reader</link>&#32;reader,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*data,
01055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*chunkname,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*mode)&#32;{
01056 &#32;&#32;<link linkend="_struct_zio">ZIO</link>&#32;z;
01057 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;status;
01058 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01059 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!chunkname)&#32;chunkname&#32;=&#32;<emphasis role="stringliteral">&quot;?&quot;</emphasis>;
01060 &#32;&#32;<link linkend="_lzio_8c_1aeac95715238190000a710e2c304133a2">luaZ_init</link>(L,&#32;&amp;z,&#32;reader,&#32;data);
01061 &#32;&#32;status&#32;=&#32;<link linkend="_ldo_8c_1a451f5a18e45a63e1da2eed7d8a2060f5">luaD_protectedparser</link>(L,&#32;&amp;z,&#32;chunkname,&#32;mode);
01062 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(status&#32;==&#32;<link linkend="_lua_8h_1ab969ff78cb1b63efa2bba3bdfa6fff5c">LUA_OK</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;no&#32;errors?&#32;*/</emphasis>
01063 &#32;&#32;&#32;&#32;<link linkend="_struct_l_closure">LClosure</link>&#32;*f&#32;=&#32;<link linkend="_lobject_8h_1afb9e65b01574a1135c582cf28883062e">clLvalue</link>(<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1));&#32;&#32;<emphasis role="comment">/*&#32;get&#32;newly&#32;created&#32;function&#32;*/</emphasis>
01064 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(f-&gt;nupvalues&#32;&gt;=&#32;1)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;does&#32;it&#32;have&#32;an&#32;upvalue?&#32;*/</emphasis>
01065 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;get&#32;global&#32;table&#32;from&#32;registry&#32;*/</emphasis>
01066 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_table">Table</link>&#32;*reg&#32;=&#32;<link linkend="_lobject_8h_1a336a6ce5e8340e6de133ec249cf47ebf">hvalue</link>(&amp;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;l_registry);
01067 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_t_value">TValue</link>&#32;*gt&#32;=&#32;<link linkend="_ltable_8c_1ae142cefd44452389877c3e3187c7973e">luaH_getint</link>(reg,&#32;<link linkend="_lua_8h_1a08ad697e382a0042a439bc9748fa2d8c">LUA_RIDX_GLOBALS</link>);
01068 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;set&#32;global&#32;table&#32;as&#32;1st&#32;upvalue&#32;of&#32;&apos;f&apos;&#32;(may&#32;be&#32;LUA_ENV)&#32;*/</emphasis>
01069 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1acf2af15f3d5cceca8e8870f96634bc2d">setobj</link>(L,&#32;f-&gt;<link linkend="_struct_l_closure_1aa4734795813776a46167fe712dfd9506">upvals</link>[0]-&gt;<link linkend="_struct_up_val_1a507ba5be7778a879769a2718d6e4afa3">v</link>,&#32;gt);
01070 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a21660a316c42bc1aad10f115e2261bca">luaC_barrier</link>(L,&#32;f-&gt;<link linkend="_struct_l_closure_1aa4734795813776a46167fe712dfd9506">upvals</link>[0],&#32;gt);
01071 &#32;&#32;&#32;&#32;}
01072 &#32;&#32;}
01073 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01074 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;status;
01075 }
01076 
01077 
<anchor xml:id="_lapi_8c_source_1l01078"/><link linkend="_lua_8h_1a9ddf288a81529204406f6d88eaa4486d">01078</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a68295f56f04fd0d5c0adfb1793a04b4c">lua_dump</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a855729196d7066b2da21178284868a8d">lua_Writer</link>&#32;<link linkend="_lstrlib_8c_1a1f7ab2869b4517a93412ce096243ead0">writer</link>,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*data,&#32;<emphasis role="keywordtype">int</emphasis>&#32;strip)&#32;{
01079 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;status;
01080 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*o;
01081 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01082 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
01083 &#32;&#32;o&#32;=&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1);
01084 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a6e8ea4626fad5e23912d4e26d0b09200">isLfunction</link>(o))
01085 &#32;&#32;&#32;&#32;status&#32;=&#32;<link linkend="_ldump_8c_1a808f6a29001ac6446f40c76014c6b6e9">luaU_dump</link>(L,&#32;<link linkend="_lobject_8h_1a36095400a8ca3ad1e6120f507b421331">getproto</link>(o),&#32;<link linkend="_lstrlib_8c_1a1f7ab2869b4517a93412ce096243ead0">writer</link>,&#32;data,&#32;strip);
01086 &#32;&#32;<emphasis role="keywordflow">else</emphasis>
01087 &#32;&#32;&#32;&#32;status&#32;=&#32;1;
01088 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01089 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;status;
01090 }
01091 
01092 
<anchor xml:id="_lapi_8c_source_1l01093"/><link linkend="_lua_8h_1af5cd8db0ed930193f1bf67c583666f91">01093</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aadea4b6f60174a1334ebde560968a615">lua_status</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L)&#32;{
01094 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;L-&gt;<link linkend="_structlua___state_1ab7ebe75445d38e722cbc077aec768b14">status</link>;
01095 }
01096 
01097 
01098 <emphasis role="comment">/*</emphasis>
01099 <emphasis role="comment">**&#32;Garbage-collection&#32;function</emphasis>
01100 <emphasis role="comment">*/</emphasis>
<anchor xml:id="_lapi_8c_source_1l01101"/><link linkend="_lua_8h_1aa4d179f50309744049e26166ee956ffd">01101</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aa93573057f708d826613186a9d40c87d">lua_gc</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;what,&#32;...)&#32;{
01102 &#32;&#32;va_list&#32;argp;
01103 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;res&#32;=&#32;0;
01104 &#32;&#32;<link linkend="_structglobal___state">global_State</link>&#32;*g;
01105 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01106 &#32;&#32;g&#32;=&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L);
01107 &#32;&#32;va_start(argp,&#32;what);
01108 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(what)&#32;{
01109 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a7080a7110a1b37afc6ea2f706e944bc3">LUA_GCSTOP</link>:&#32;{
01110 &#32;&#32;&#32;&#32;&#32;&#32;g-&gt;<link linkend="_structglobal___state_1a39557d352dfca7f1553b694d54c0b662">gcrunning</link>&#32;=&#32;0;
01111 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01112 &#32;&#32;&#32;&#32;}
01113 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a73701e5990022e938e90828a2c8291a4">LUA_GCRESTART</link>:&#32;{
01114 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lstate_8c_1a42e891d6a8e1dc58d9a1487cefd9c236">luaE_setdebt</link>(g,&#32;0);
01115 &#32;&#32;&#32;&#32;&#32;&#32;g-&gt;<link linkend="_structglobal___state_1a39557d352dfca7f1553b694d54c0b662">gcrunning</link>&#32;=&#32;1;
01116 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01117 &#32;&#32;&#32;&#32;}
01118 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a59b8b65be08a10442ea2ae41289f5073">LUA_GCCOLLECT</link>:&#32;{
01119 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8c_1ac48130e5263ad8be09a9c51dae6125b9">luaC_fullgc</link>(L,&#32;0);
01120 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01121 &#32;&#32;&#32;&#32;}
01122 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a3f8f1ebdffa4dbfe2dd89c2fd86bd7f4">LUA_GCCOUNT</link>:&#32;{
01123 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;GC&#32;values&#32;are&#32;expressed&#32;in&#32;Kbytes:&#32;#bytes/2^10&#32;*/</emphasis>
01124 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_llimits_8h_1a37a9e2c4b53433d34bad0f12a1500c08">cast_int</link>(<link linkend="_lstate_8h_1a27490dbb57469f3fa83a73d4b7a79df2">gettotalbytes</link>(g)&#32;&gt;&gt;&#32;10);
01125 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01126 &#32;&#32;&#32;&#32;}
01127 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a99f1685cd6789e0b9bbd2a4c080fbaed">LUA_GCCOUNTB</link>:&#32;{
01128 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_llimits_8h_1a37a9e2c4b53433d34bad0f12a1500c08">cast_int</link>(<link linkend="_lstate_8h_1a27490dbb57469f3fa83a73d4b7a79df2">gettotalbytes</link>(g)&#32;&amp;&#32;0x3ff);
01129 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01130 &#32;&#32;&#32;&#32;}
01131 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a9e7f3eaf2e269c3422aea3fd7c8973ef">LUA_GCSTEP</link>:&#32;{
01132 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;data&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01133 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1a24fc195087e262c99a4cf0f9b346a684">l_mem</link>&#32;debt&#32;=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;=1&#32;to&#32;signal&#32;that&#32;it&#32;did&#32;an&#32;actual&#32;step&#32;*/</emphasis>
01134 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</link>&#32;oldrunning&#32;=&#32;g-&gt;<link linkend="_structglobal___state_1a39557d352dfca7f1553b694d54c0b662">gcrunning</link>;
01135 &#32;&#32;&#32;&#32;&#32;&#32;g-&gt;<link linkend="_structglobal___state_1a39557d352dfca7f1553b694d54c0b662">gcrunning</link>&#32;=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;allow&#32;GC&#32;to&#32;run&#32;*/</emphasis>
01136 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(data&#32;==&#32;0)&#32;{
01137 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lstate_8c_1a42e891d6a8e1dc58d9a1487cefd9c236">luaE_setdebt</link>(g,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;do&#32;a&#32;basic&#32;step&#32;*/</emphasis>
01138 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8c_1ab0133eb7bb37a0a690e0ef71fbc13414">luaC_step</link>(L);
01139 &#32;&#32;&#32;&#32;&#32;&#32;}
01140 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;add&#32;&apos;data&apos;&#32;to&#32;total&#32;debt&#32;*/</emphasis>
01141 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;debt&#32;=&#32;<link linkend="_llimits_8h_1af17d62ec9e237a7644de6b9b34a48a34">cast</link>(<link linkend="_llimits_8h_1a24fc195087e262c99a4cf0f9b346a684">l_mem</link>,&#32;data)&#32;*&#32;1024&#32;+&#32;g-&gt;<link linkend="_structglobal___state_1ae466d806319d4ba1b672bbff60f369f9">GCdebt</link>;
01142 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lstate_8c_1a42e891d6a8e1dc58d9a1487cefd9c236">luaE_setdebt</link>(g,&#32;debt);
01143 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
01144 &#32;&#32;&#32;&#32;&#32;&#32;}
01145 &#32;&#32;&#32;&#32;&#32;&#32;g-&gt;<link linkend="_structglobal___state_1a39557d352dfca7f1553b694d54c0b662">gcrunning</link>&#32;=&#32;oldrunning;&#32;&#32;<emphasis role="comment">/*&#32;restore&#32;previous&#32;state&#32;*/</emphasis>
01146 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(debt&#32;&gt;&#32;0&#32;&amp;&amp;&#32;g-&gt;<link linkend="_structglobal___state_1aec22885c483e649f2d65368c3507cd9a">gcstate</link>&#32;==&#32;<link linkend="_lgc_8h_1ab546d91106ec5cfdba254de13e5b5c5f">GCSpause</link>)&#32;&#32;<emphasis role="comment">/*&#32;end&#32;of&#32;cycle?&#32;*/</emphasis>
01147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;signal&#32;it&#32;*/</emphasis>
01148 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01149 &#32;&#32;&#32;&#32;}
01150 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a28342bd4f96a077c7447489073dfa376">LUA_GCSETPAUSE</link>:&#32;{
01151 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;data&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01152 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_lgc_8h_1a1991625e57703760cf5236bc02cd8858">getgcparam</link>(g-&gt;<link linkend="_structglobal___state_1af8555bb94d52c1ab47ba9f877ae40494">gcpause</link>);
01153 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a757077227d006e517adfaa82c2d30e72">setgcparam</link>(g-&gt;<link linkend="_structglobal___state_1af8555bb94d52c1ab47ba9f877ae40494">gcpause</link>,&#32;data);
01154 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01155 &#32;&#32;&#32;&#32;}
01156 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1af07b3449c8e3ffdd62649443f32e1931">LUA_GCSETSTEPMUL</link>:&#32;{
01157 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;data&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01158 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_lgc_8h_1a1991625e57703760cf5236bc02cd8858">getgcparam</link>(g-&gt;<link linkend="_structglobal___state_1aaf11518fe18dec6b3e2e4d8a9a95f428">gcstepmul</link>);
01159 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a757077227d006e517adfaa82c2d30e72">setgcparam</link>(g-&gt;<link linkend="_structglobal___state_1aaf11518fe18dec6b3e2e4d8a9a95f428">gcstepmul</link>,&#32;data);
01160 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01161 &#32;&#32;&#32;&#32;}
01162 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a5bdb85acea7589c5b21ea88dcb4d6179">LUA_GCISRUNNING</link>:&#32;{
01163 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;g-&gt;<link linkend="_structglobal___state_1a39557d352dfca7f1553b694d54c0b662">gcrunning</link>;
01164 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01165 &#32;&#32;&#32;&#32;}
01166 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a1d84f39f245a70f10e74bb5b9026fefd">LUA_GCGEN</link>:&#32;{
01167 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;minormul&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01168 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;majormul&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01169 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_lgc_8h_1a634f3aa786242e81eb2d29da7cdacf4a">isdecGCmodegen</link>(g)&#32;?&#32;<link linkend="_lua_8h_1a1d84f39f245a70f10e74bb5b9026fefd">LUA_GCGEN</link>&#32;:&#32;<link linkend="_lua_8h_1a50d1226a69fe8049b110d4a3577cc797">LUA_GCINC</link>;
01170 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(minormul&#32;!=&#32;0)
01171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;g-&gt;<link linkend="_structglobal___state_1a8c94405dfaa56f002f0df59c53598658">genminormul</link>&#32;=&#32;minormul;
01172 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(majormul&#32;!=&#32;0)
01173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a757077227d006e517adfaa82c2d30e72">setgcparam</link>(g-&gt;<link linkend="_structglobal___state_1af742f5e67f1ead7df0044b4903a65771">genmajormul</link>,&#32;majormul);
01174 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8c_1ac88d5c236307393937e02bc82c10f970">luaC_changemode</link>(L,&#32;<link linkend="_lstate_8h_1aa2765fe939333ebc895ba9cedbaa30a0">KGC_GEN</link>);
01175 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01176 &#32;&#32;&#32;&#32;}
01177 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lua_8h_1a50d1226a69fe8049b110d4a3577cc797">LUA_GCINC</link>:&#32;{
01178 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;pause&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01179 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;stepmul&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01180 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;stepsize&#32;=&#32;va_arg(argp,&#32;<emphasis role="keywordtype">int</emphasis>);
01181 &#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_lgc_8h_1a634f3aa786242e81eb2d29da7cdacf4a">isdecGCmodegen</link>(g)&#32;?&#32;<link linkend="_lua_8h_1a1d84f39f245a70f10e74bb5b9026fefd">LUA_GCGEN</link>&#32;:&#32;<link linkend="_lua_8h_1a50d1226a69fe8049b110d4a3577cc797">LUA_GCINC</link>;
01182 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pause&#32;!=&#32;0)
01183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a757077227d006e517adfaa82c2d30e72">setgcparam</link>(g-&gt;<link linkend="_structglobal___state_1af8555bb94d52c1ab47ba9f877ae40494">gcpause</link>,&#32;pause);
01184 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stepmul&#32;!=&#32;0)
01185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a757077227d006e517adfaa82c2d30e72">setgcparam</link>(g-&gt;<link linkend="_structglobal___state_1aaf11518fe18dec6b3e2e4d8a9a95f428">gcstepmul</link>,&#32;stepmul);
01186 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stepsize&#32;!=&#32;0)
01187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;g-&gt;<link linkend="_structglobal___state_1a20818519922dad51df664111576a73b8">gcstepsize</link>&#32;=&#32;stepsize;
01188 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_lgc_8c_1ac88d5c236307393937e02bc82c10f970">luaC_changemode</link>(L,&#32;<link linkend="_lstate_8h_1a52c54e51ee8ad2218ac72b745afc2f7d">KGC_INC</link>);
01189 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
01190 &#32;&#32;&#32;&#32;}
01191 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;res&#32;=&#32;-1;&#32;&#32;<emphasis role="comment">/*&#32;invalid&#32;option&#32;*/</emphasis>
01192 &#32;&#32;}
01193 &#32;&#32;va_end(argp);
01194 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01195 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
01196 }
01197 
01198 
01199 
01200 <emphasis role="comment">/*</emphasis>
01201 <emphasis role="comment">**&#32;miscellaneous&#32;functions</emphasis>
01202 <emphasis role="comment">*/</emphasis>
01203 
01204 
<anchor xml:id="_lapi_8c_source_1l01205"/><link linkend="_lua_8h_1aae6c05ddea7bd110a3e84595ef92e601">01205</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1a6ba7b91143fe8a03910420d800de8e97">lua_error</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L)&#32;{
01206 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*errobj;
01207 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01208 &#32;&#32;errobj&#32;=&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1);
01209 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
01210 &#32;&#32;<emphasis role="comment">/*&#32;error&#32;object&#32;is&#32;the&#32;memory&#32;error&#32;message?&#32;*/</emphasis>
01211 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_lobject_8h_1a6513e161c7e8cc7276a9677d50a99b76">ttisshrstring</link>(errobj)&#32;&amp;&amp;&#32;<link linkend="_lstring_8h_1add3806315bf73de7d3138c019ed7c0ce">eqshrstr</link>(<link linkend="_lobject_8h_1a8661397faed512ccc9c70a4661f1a83d">tsvalue</link>(errobj),&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;memerrmsg))
01212 &#32;&#32;&#32;&#32;<link linkend="_lmem_8h_1ae11aaaf07d13b2f0c3a671b01d7e3822">luaM_error</link>(L);&#32;&#32;<emphasis role="comment">/*&#32;raise&#32;a&#32;memory&#32;error&#32;*/</emphasis>
01213 &#32;&#32;<emphasis role="keywordflow">else</emphasis>
01214 &#32;&#32;&#32;&#32;<link linkend="_ldebug_8c_1af7366920f8408bb33ed01b1d6c0e1238">luaG_errormsg</link>(L);&#32;&#32;<emphasis role="comment">/*&#32;raise&#32;a&#32;regular&#32;error&#32;*/</emphasis>
01215 &#32;&#32;<emphasis role="comment">/*&#32;code&#32;unreachable;&#32;will&#32;unlock&#32;when&#32;control&#32;actually&#32;leaves&#32;the&#32;kernel&#32;*/</emphasis>
01216 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;to&#32;avoid&#32;warnings&#32;*/</emphasis>
01217 }
01218 
01219 
<anchor xml:id="_lapi_8c_source_1l01220"/><link linkend="_lua_8h_1a2a62b957ab95d9b542bf7d02794181e6">01220</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_lapi_8c_1aa8bf464b98335a075732200ad91ce1de">lua_next</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
01221 &#32;&#32;<link linkend="_struct_table">Table</link>&#32;*t;
01222 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;more;
01223 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01224 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
01225 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a4ebfbcdc1a7a4f0332d4dd532a817212">gettable</link>(L,&#32;idx);
01226 &#32;&#32;more&#32;=&#32;<link linkend="_ltable_8c_1a3c4370ade14fcc86ede5ca90271d0f30">luaH_next</link>(L,&#32;t,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-&#32;1);
01227 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(more)&#32;{
01228 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
01229 &#32;&#32;}
01230 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;&#32;<emphasis role="comment">/*&#32;no&#32;more&#32;elements&#32;*/</emphasis>
01231 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>&#32;-=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;remove&#32;key&#32;*/</emphasis>
01232 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01233 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;more;
01234 }
01235 
01236 
<anchor xml:id="_lapi_8c_source_1l01237"/><link linkend="_lua_8h_1a0a4a79d6be16534af93a7c4de2c86724">01237</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a5101545bcd4222abe101836b7931bdf9">lua_toclose</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
01238 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>;
01239 &#32;&#32;<link linkend="_union_stack_value">StkId</link>&#32;o;
01240 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01241 &#32;&#32;o&#32;=&#32;<link linkend="_lapi_8c_1a7acfd65878b2f2c7529c788ce08d1949">index2stack</link>(L,&#32;idx);
01242 &#32;&#32;<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>&#32;=&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1a2c5cabcdf2f8f5b8e0c72171401e0430">nresults</link>;
01243 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1a762ab4537c3697fa94e74b3c0dffd297">openupval</link>&#32;==&#32;NULL&#32;||&#32;<link linkend="_lfunc_8h_1a9c84a07f72721f9536fc43e26ae84c8b">uplevel</link>(L-&gt;<link linkend="_structlua___state_1a762ab4537c3697fa94e74b3c0dffd297">openupval</link>)&#32;&lt;=&#32;o,
01244 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;marked&#32;index&#32;below&#32;or&#32;equal&#32;new&#32;one&quot;</emphasis>);
01245 &#32;&#32;<link linkend="_lfunc_8c_1a0f1719e232a25ecfcafed14f8b39ad31">luaF_newtbcupval</link>(L,&#32;o);&#32;&#32;<emphasis role="comment">/*&#32;create&#32;new&#32;to-be-closed&#32;upvalue&#32;*/</emphasis>
01246 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_lapi_8h_1a5707387c1d9df9ae5bea729c1109ddf6">hastocloseCfunc</link>(<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>))&#32;&#32;<emphasis role="comment">/*&#32;function&#32;not&#32;marked&#32;yet?&#32;*/</emphasis>
01247 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1a2c5cabcdf2f8f5b8e0c72171401e0430">nresults</link>&#32;=&#32;<link linkend="_lapi_8h_1a605e47ad8af5d2c7a821081dc37ddc90">codeNresults</link>(<link linkend="_struct_call_s_1a533d8864d8bb14c328c893022bba3155">nresults</link>);&#32;&#32;<emphasis role="comment">/*&#32;mark&#32;it&#32;*/</emphasis>
01248 &#32;&#32;<link linkend="_llimits_8h_1a5978f5fda715bd80e845df1e16ad7780">lua_assert</link>(<link linkend="_lapi_8h_1a5707387c1d9df9ae5bea729c1109ddf6">hastocloseCfunc</link>(L-&gt;<link linkend="_structlua___state_1a8764223139091552413c85d3fc0bb1eb">ci</link>-&gt;<link linkend="_struct_call_info_1a2c5cabcdf2f8f5b8e0c72171401e0430">nresults</link>));
01249 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01250 }
01251 
01252 
<anchor xml:id="_lapi_8c_source_1l01253"/><link linkend="_lua_8h_1a4eba0457df5bafff4d44071d1d8080b6">01253</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a1de3afee1daece63d455f23818c883d9">lua_concat</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
01254 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01255 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;n);
01256 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&gt;&#32;0)
01257 &#32;&#32;&#32;&#32;<link linkend="_lvm_8c_1a2f076040af405dcb50d661edd692eca7">luaV_concat</link>(L,&#32;n);
01258 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;nothing&#32;to&#32;concatenate&#32;*/</emphasis>
01259 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1aa60b4c3bb90063dcaa2f90e77d4a61f6">setsvalue2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;<link linkend="_lstring_8c_1ab41fb084ce3ea5e2779f6659ccc2484d">luaS_newlstr</link>(L,&#32;<emphasis role="stringliteral">&quot;&quot;</emphasis>,&#32;0));&#32;&#32;<emphasis role="comment">/*&#32;push&#32;empty&#32;string&#32;*/</emphasis>
01260 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
01261 &#32;&#32;}
01262 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
01263 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01264 }
01265 
01266 
<anchor xml:id="_lapi_8c_source_1l01267"/><link linkend="_lua_8h_1ac7ade66f92b5e325c42371926f879818">01267</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a28bdc8c01771ec2524b329a409a08040">lua_len</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx)&#32;{
01268 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*t;
01269 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01270 &#32;&#32;t&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;idx);
01271 &#32;&#32;<link linkend="_lvm_8c_1aae23b597659b2aae680f1d0a0b39ab3b">luaV_objlen</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;t);
01272 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
01273 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01274 }
01275 
01276 
<anchor xml:id="_lapi_8c_source_1l01277"/><link linkend="_lua_8h_1ab5b8729206c208fbb794c9c2840b0812">01277</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<link linkend="_lua_8h_1a2fee348bffcc82b15c626b27f66a748b">lua_Alloc</link>&#32;<link linkend="_lapi_8c_1a3dbff8747b32b799cf63603c46da06cc">lua_getallocf</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">void</emphasis>&#32;**ud)&#32;{
01278 &#32;&#32;<link linkend="_lua_8h_1a2fee348bffcc82b15c626b27f66a748b">lua_Alloc</link>&#32;f;
01279 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01280 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ud)&#32;*ud&#32;=&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;ud;
01281 &#32;&#32;f&#32;=&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;frealloc;
01282 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01283 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;f;
01284 }
01285 
01286 
<anchor xml:id="_lapi_8c_source_1l01287"/><link linkend="_lua_8h_1a9d88848772cf14b58792115fedf4cd3c">01287</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1ac890276f9590df6a4d6aabdad9c558f0">lua_setallocf</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a2fee348bffcc82b15c626b27f66a748b">lua_Alloc</link>&#32;f,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*ud)&#32;{
01288 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01289 &#32;&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;ud&#32;=&#32;ud;
01290 &#32;&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;frealloc&#32;=&#32;f;
01291 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01292 }
01293 
01294 
<anchor xml:id="_lapi_8c_source_1l01295"/><link linkend="_lua_8h_1a4306d6a079b2b3ad7ee416b0a6fff3e7">01295</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a708d3ea569d1e7174f06281ecba5a091">lua_setwarnf</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<link linkend="_lua_8h_1a01be53d7e053b2703a9a0ee91aff4974">lua_WarnFunction</link>&#32;f,&#32;<emphasis role="keywordtype">void</emphasis>&#32;*ud)&#32;{
01296 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01297 &#32;&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;ud_warn&#32;=&#32;ud;
01298 &#32;&#32;<link linkend="_lstate_8h_1a103db2de6edf3420c6c6c9a282562406">G</link>(L)-&gt;warnf&#32;=&#32;f;
01299 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01300 }
01301 
01302 
<anchor xml:id="_lapi_8c_source_1l01303"/><link linkend="_lua_8h_1ab1427d47a6a2d111c62756c0c8c778b5">01303</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a383441029934d459d9b7cd89d3c851e8">lua_warning</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*msg,&#32;<emphasis role="keywordtype">int</emphasis>&#32;tocont)&#32;{
01304 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01305 &#32;&#32;<link linkend="_lstate_8c_1a7055cc5e36512e37c811a7d5c6fa0be6">luaE_warning</link>(L,&#32;msg,&#32;tocont);
01306 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01307 }
01308 
01309 
01310 
<anchor xml:id="_lapi_8c_source_1l01311"/><link linkend="_lua_8h_1a77a7f314b801aa279d602da51ee9601b">01311</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*<link linkend="_lapi_8c_1a9c09a58b86c71e997d7ccabb67f18c12">lua_newuserdatauv</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">size_t</emphasis>&#32;size,&#32;<emphasis role="keywordtype">int</emphasis>&#32;nuvalue)&#32;{
01312 &#32;&#32;<link linkend="_struct_udata">Udata</link>&#32;*u;
01313 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01314 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;0&#32;&lt;=&#32;nuvalue&#32;&amp;&amp;&#32;nuvalue&#32;&lt;&#32;USHRT_MAX,&#32;<emphasis role="stringliteral">&quot;invalid&#32;value&quot;</emphasis>);
01315 &#32;&#32;u&#32;=&#32;<link linkend="_lstring_8c_1af1d43cf7a422ae988e1b28ee670fa5f4">luaS_newudata</link>(L,&#32;size,&#32;nuvalue);
01316 &#32;&#32;<link linkend="_lobject_8h_1ab358ecf44046d8def185fed182944fc1">setuvalue</link>(L,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>),&#32;u);
01317 &#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
01318 &#32;&#32;<link linkend="_lgc_8h_1ad013db5004ccc5fbe8a6450caa1f1ad9">luaC_checkGC</link>(L);
01319 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01320 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_lobject_8h_1a2caa96489ffdf9759e50fda47d69f605">getudatamem</link>(u);
01321 }
01322 
01323 
01324 
<anchor xml:id="_lapi_8c_source_1l01325"/><link linkend="_lapi_8c_1aa300a4cd32bcefdee8e1457e0e4fbacb">01325</link> <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1aa300a4cd32bcefdee8e1457e0e4fbacb">aux_upvalue</link>&#32;(<link linkend="_struct_t_value">TValue</link>&#32;*fi,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n,&#32;<link linkend="_struct_t_value">TValue</link>&#32;**val,
01326 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_g_c_object">GCObject</link>&#32;**owner)&#32;{
01327 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1a01db083f8bc8b2eb51a45c0ba9967043">ttypetag</link>(fi))&#32;{
01328 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a2361d923ddb7fc1468b978fe043e35c2">LUA_VCCL</link>:&#32;{&#32;&#32;<emphasis role="comment">/*&#32;C&#32;closure&#32;*/</emphasis>
01329 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_c_closure">CClosure</link>&#32;*f&#32;=&#32;<link linkend="_lobject_8h_1a2c2d10bdd241446b4c9e1b68268159bc">clCvalue</link>(fi);
01330 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(<link linkend="_llimits_8h_1a6ce2ddc5b419ed6f302573db3cc03e56">cast_uint</link>(n)&#32;-&#32;1u&#32;&lt;&#32;<link linkend="_llimits_8h_1a6ce2ddc5b419ed6f302573db3cc03e56">cast_uint</link>(f-&gt;nupvalues)))
01331 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;&apos;n&apos;&#32;not&#32;in&#32;[1,&#32;f-&gt;nupvalues]&#32;*/</emphasis>
01332 &#32;&#32;&#32;&#32;&#32;&#32;*val&#32;=&#32;&amp;f-&gt;<link linkend="_struct_c_closure_1a5d6ca5386d338c19af338be60a375dd4">upvalue</link>[n-1];
01333 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(owner)&#32;*owner&#32;=&#32;<link linkend="_lstate_8h_1a254ca29aba03e47440082d4591a9734e">obj2gco</link>(f);
01334 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="stringliteral">&quot;&quot;</emphasis>;
01335 &#32;&#32;&#32;&#32;}
01336 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a5d0e6e41ea93960667095501aa5745c1">LUA_VLCL</link>:&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Lua&#32;closure&#32;*/</emphasis>
01337 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_l_closure">LClosure</link>&#32;*f&#32;=&#32;<link linkend="_lobject_8h_1afb9e65b01574a1135c582cf28883062e">clLvalue</link>(fi);
01338 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_t_string">TString</link>&#32;*name;
01339 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_proto">Proto</link>&#32;*p&#32;=&#32;f-&gt;<link linkend="_struct_l_closure_1aed1f50b9bdc5ce4c7cfa49529472b42c">p</link>;
01340 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(<link linkend="_llimits_8h_1a6ce2ddc5b419ed6f302573db3cc03e56">cast_uint</link>(n)&#32;-&#32;1u&#32;&#32;&lt;&#32;<link linkend="_llimits_8h_1a6ce2ddc5b419ed6f302573db3cc03e56">cast_uint</link>(p-&gt;<link linkend="_struct_proto_1a2e13a98343ef0d1233bb3e62ae519c5f">sizeupvalues</link>)))
01341 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;&apos;n&apos;&#32;not&#32;in&#32;[1,&#32;p-&gt;sizeupvalues]&#32;*/</emphasis>
01342 &#32;&#32;&#32;&#32;&#32;&#32;*val&#32;=&#32;f-&gt;<link linkend="_struct_l_closure_1aa4734795813776a46167fe712dfd9506">upvals</link>[n-1]-&gt;<link linkend="_struct_up_val_1a507ba5be7778a879769a2718d6e4afa3">v</link>;
01343 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(owner)&#32;*owner&#32;=&#32;<link linkend="_lstate_8h_1a254ca29aba03e47440082d4591a9734e">obj2gco</link>(f-&gt;<link linkend="_struct_l_closure_1aa4734795813776a46167fe712dfd9506">upvals</link>[n&#32;-&#32;1]);
01344 &#32;&#32;&#32;&#32;&#32;&#32;name&#32;=&#32;p-&gt;<link linkend="_struct_proto_1ac3b891662880254a7e0a3dc0afa86254">upvalues</link>[n-1].<link linkend="_struct_upvaldesc_1aa249fce0e5297641aa43f45e48bb1548">name</link>;
01345 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(name&#32;==&#32;NULL)&#32;?&#32;<emphasis role="stringliteral">&quot;(no&#32;name)&quot;</emphasis>&#32;:&#32;<link linkend="_lobject_8h_1acb05d3ab238923581a9c629b8e11a6ac">getstr</link>(name);
01346 &#32;&#32;&#32;&#32;}
01347 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;not&#32;a&#32;closure&#32;*/</emphasis>
01348 &#32;&#32;}
01349 }
01350 
01351 
<anchor xml:id="_lapi_8c_source_1l01352"/><link linkend="_lua_8h_1af30136978fa4de5e7fa8a434b8ca8611">01352</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1afd5e7d6995dc52a5cb9e370ee3a710e6">lua_getupvalue</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;funcindex,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
01353 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*name;
01354 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*val&#32;=&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;to&#32;avoid&#32;warnings&#32;*/</emphasis>
01355 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01356 &#32;&#32;name&#32;=&#32;<link linkend="_lapi_8c_1aa300a4cd32bcefdee8e1457e0e4fbacb">aux_upvalue</link>(<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;funcindex),&#32;n,&#32;&amp;val,&#32;NULL);
01357 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(name)&#32;{
01358 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1add70d29b431f66a1dee29a0cb286de6e">setobj2s</link>(L,&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>,&#32;val);
01359 &#32;&#32;&#32;&#32;<link linkend="_lapi_8h_1afe4a5994dd3704ec53de77f9fd121915">api_incr_top</link>(L);
01360 &#32;&#32;}
01361 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01362 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;name;
01363 }
01364 
01365 
<anchor xml:id="_lapi_8c_source_1l01366"/><link linkend="_lua_8h_1a6a2640dd28d1b773dcf36f1c8112835e">01366</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<link linkend="_lapi_8c_1a6e2e5717e848fca56335a64739a8f2c0">lua_setupvalue</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;funcindex,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
01367 &#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*name;
01368 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*val&#32;=&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;to&#32;avoid&#32;warnings&#32;*/</emphasis>
01369 &#32;&#32;<link linkend="_struct_g_c_object">GCObject</link>&#32;*owner&#32;=&#32;NULL;&#32;&#32;<emphasis role="comment">/*&#32;to&#32;avoid&#32;warnings&#32;*/</emphasis>
01370 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*fi;
01371 &#32;&#32;<link linkend="_llimits_8h_1aa68a48b9104aeadf4842c25c12a9b8c9">lua_lock</link>(L);
01372 &#32;&#32;fi&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;funcindex);
01373 &#32;&#32;<link linkend="_lapi_8h_1a9785915283c3f0a0ec90f1b6be32b2c2">api_checknelems</link>(L,&#32;1);
01374 &#32;&#32;name&#32;=&#32;<link linkend="_lapi_8c_1aa300a4cd32bcefdee8e1457e0e4fbacb">aux_upvalue</link>(fi,&#32;n,&#32;&amp;val,&#32;&amp;owner);
01375 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(name)&#32;{
01376 &#32;&#32;&#32;&#32;L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>--;
01377 &#32;&#32;&#32;&#32;<link linkend="_lobject_8h_1acf2af15f3d5cceca8e8870f96634bc2d">setobj</link>(L,&#32;val,&#32;<link linkend="_lobject_8h_1a8c21cbb67def90b23342840cd08a5cfd">s2v</link>(L-&gt;<link linkend="_structlua___state_1afeb5dbe379fc406b35fe5f8a5fcfc5d7">top</link>));
01378 &#32;&#32;&#32;&#32;<link linkend="_lgc_8h_1a21660a316c42bc1aad10f115e2261bca">luaC_barrier</link>(L,&#32;owner,&#32;val);
01379 &#32;&#32;}
01380 &#32;&#32;<link linkend="_llimits_8h_1a1781f2a7d9161848a246d475a9171875">lua_unlock</link>(L);
01381 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;name;
01382 }
01383 
01384 
<anchor xml:id="_lapi_8c_source_1l01385"/><link linkend="_lapi_8c_1afe9a3b06ff27bba372b28ad108c9c3e8">01385</link> <emphasis role="keyword">static</emphasis>&#32;<link linkend="_struct_up_val">UpVal</link>&#32;**<link linkend="_lapi_8c_1afe9a3b06ff27bba372b28ad108c9c3e8">getupvalref</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;fidx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n,&#32;<link linkend="_struct_l_closure">LClosure</link>&#32;**pf)&#32;{
01386 &#32;&#32;<link linkend="_struct_l_closure">LClosure</link>&#32;*f;
01387 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*fi&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;fidx);
01388 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;<link linkend="_lobject_8h_1a6f8bada57bc9f224609af800d399693f">ttisLclosure</link>(fi),&#32;<emphasis role="stringliteral">&quot;Lua&#32;function&#32;expected&quot;</emphasis>);
01389 &#32;&#32;f&#32;=&#32;<link linkend="_lobject_8h_1afb9e65b01574a1135c582cf28883062e">clLvalue</link>(fi);
01390 &#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;(1&#32;&lt;=&#32;n&#32;&amp;&amp;&#32;n&#32;&lt;=&#32;f-&gt;p-&gt;sizeupvalues),&#32;<emphasis role="stringliteral">&quot;invalid&#32;upvalue&#32;index&quot;</emphasis>);
01391 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pf)&#32;*pf&#32;=&#32;f;
01392 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;&amp;f-&gt;<link linkend="_struct_l_closure_1aa4734795813776a46167fe712dfd9506">upvals</link>[n&#32;-&#32;1];&#32;&#32;<emphasis role="comment">/*&#32;get&#32;its&#32;upvalue&#32;pointer&#32;*/</emphasis>
01393 }
01394 
01395 
<anchor xml:id="_lapi_8c_source_1l01396"/><link linkend="_lua_8h_1ac0df7bf2b2de17979cb3e2d96dc78bcb">01396</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;*<link linkend="_lapi_8c_1af20e3a68caf3e24d35318baf952c5567">lua_upvalueid</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;fidx,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;{
01397 &#32;&#32;<link linkend="_struct_t_value">TValue</link>&#32;*fi&#32;=&#32;<link linkend="_lapi_8c_1a7c66797ff8396fc9258bb9fc08e959d8">index2value</link>(L,&#32;fidx);
01398 &#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(<link linkend="_lobject_8h_1a01db083f8bc8b2eb51a45c0ba9967043">ttypetag</link>(fi))&#32;{
01399 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a5d0e6e41ea93960667095501aa5745c1">LUA_VLCL</link>:&#32;{&#32;&#32;<emphasis role="comment">/*&#32;lua&#32;closure&#32;*/</emphasis>
01400 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;*<link linkend="_lapi_8c_1afe9a3b06ff27bba372b28ad108c9c3e8">getupvalref</link>(L,&#32;fidx,&#32;n,&#32;NULL);
01401 &#32;&#32;&#32;&#32;}
01402 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_lobject_8h_1a2361d923ddb7fc1468b978fe043e35c2">LUA_VCCL</link>:&#32;{&#32;&#32;<emphasis role="comment">/*&#32;C&#32;closure&#32;*/</emphasis>
01403 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_c_closure">CClosure</link>&#32;*f&#32;=&#32;<link linkend="_lobject_8h_1a2c2d10bdd241446b4c9e1b68268159bc">clCvalue</link>(fi);
01404 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;1&#32;&lt;=&#32;n&#32;&amp;&amp;&#32;n&#32;&lt;=&#32;f-&gt;nupvalues,&#32;<emphasis role="stringliteral">&quot;invalid&#32;upvalue&#32;index&quot;</emphasis>);
01405 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;&amp;f-&gt;<link linkend="_struct_c_closure_1a5d6ca5386d338c19af338be60a375dd4">upvalue</link>[n&#32;-&#32;1];
01406 &#32;&#32;&#32;&#32;}
01407 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;{
01408 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_llimits_8h_1ad7a42e1cc11f94e1f06ed80814fcb606">api_check</link>(L,&#32;0,&#32;<emphasis role="stringliteral">&quot;closure&#32;expected&quot;</emphasis>);
01409 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;NULL;
01410 &#32;&#32;&#32;&#32;}
01411 &#32;&#32;}
01412 }
01413 
01414 
<anchor xml:id="_lapi_8c_source_1l01415"/><link linkend="_lua_8h_1a62aee315ee713d18eefced3cedade7ae">01415</link> <link linkend="_luaconf_8h_1af88575eb79fdd88b1cce4533ab5cbe69">LUA_API</link>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_lapi_8c_1a9ce27da3bd8232ac4a0d383e924a0c7a">lua_upvaluejoin</link>&#32;(<link linkend="_structlua___state">lua_State</link>&#32;*L,&#32;<emphasis role="keywordtype">int</emphasis>&#32;fidx1,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n1,
01416 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;fidx2,&#32;<emphasis role="keywordtype">int</emphasis>&#32;n2)&#32;{
01417 &#32;&#32;<link linkend="_struct_l_closure">LClosure</link>&#32;*f1;
01418 &#32;&#32;<link linkend="_struct_up_val">UpVal</link>&#32;**up1&#32;=&#32;<link linkend="_lapi_8c_1afe9a3b06ff27bba372b28ad108c9c3e8">getupvalref</link>(L,&#32;fidx1,&#32;n1,&#32;&amp;f1);
01419 &#32;&#32;<link linkend="_struct_up_val">UpVal</link>&#32;**up2&#32;=&#32;<link linkend="_lapi_8c_1afe9a3b06ff27bba372b28ad108c9c3e8">getupvalref</link>(L,&#32;fidx2,&#32;n2,&#32;NULL);
01420 &#32;&#32;*up1&#32;=&#32;*up2;
01421 &#32;&#32;<link linkend="_lgc_8h_1a90ac4f3c7085a418025edcc7215e8983">luaC_objbarrier</link>(L,&#32;f1,&#32;*up1);
01422 }
01423 
01424 
</programlisting></section>
